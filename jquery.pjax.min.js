/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.9.0
 * @updated 2013/04/30
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor Closure Compiler
 */
(function(){function v(v){function w(b,c,k,e,a,q){function u(l){a:if(a.speedcheck&&a.log.speed.name.push("update_start"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),!1!==j(a.callbacks.update.before,b,[c,a.parameter,h,m,f])){try{if(!l&&-1===f.getResponseHeader("Content-Type").indexOf("text/html"))throw Error();var x,d,q;l&&!1!==j(a.callbacks.update.cache.load.before,b,[c,a.parameter,l])&&(f=l.XMLHttpRequest,h=f.responseText,m=l.dataType,x=l.title,d=l.css,q=l.script,j(a.callbacks.update.cache.load.after,
b,[c,a.parameter,l]));var n=jQuery(h),s=0<n.filter("title").length;x=x?x:s?n.filter("title").text():B(h,"<title>([^<]*)</title>");var v=a.area.split(","),w=null===a.scrollLeft?jQuery(p).scrollLeft():parseInt(a.scrollLeft),A=null===a.scrollTop?jQuery(p).scrollTop():parseInt(a.scrollTop);if(!jQuery(a.area).length||!n.find(a.area).add(n.filter(a.area)).length)throw Error();if(!1!==j(a.callbacks.update.url.before,b,[c,a.parameter,h,m,f])){k=k.replace(RegExp("[?&]"+a.server.query+"=[^&#]*"),"");switch(!0){case e:p.history.pushState("pjax",
p.opera||"userAgent"in p&&-1!==userAgent.indexOf("opera")?x:C.title,k);case /Mobile(\/\w+)? Safari/i.test(p.navigator.userAgent):a.disable=!0,p.history.back(),p.history.forward(),a.disable=!1}j(a.callbacks.update.url.after,b,[c,a.parameter,h,m,f])}!1!==j(a.callbacks.update.title.before,b,[c,a.parameter,h,m,f])&&(C.title=x,j(a.callbacks.update.title.after,b,[c,a.parameter,h,m,f]));if(!1!==j(a.callbacks.update.content.before,b,[c,a.parameter,h,m,f])){for(var r=0,y;y=v[r];r++)jQuery(y).html(n.find(y).add(n.filter(y)).html()),
a.load.script&&a.load.sync&&jQuery(y).append(jQuery("<div/>",{"class":a.nss.class4html+"-loaded",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax"));j(a.callbacks.update.content.after,b,[c,a.parameter,h,m,f])}a.load.css&&
setTimeout(function(){if(!1!==j(a.callbacks.update.css.before,b,[c,a.parameter,h,m,f])){d=d?d:s?n.find('link[rel="stylesheet"], style').add(n.filter('link[rel="stylesheet"], style')):B(h,'(<link[^>]*?rel="stylesheet"[^>]*?>|<style[^>]*?>(.|[\n\r])*?</style>)');a.history.data[k].css=d;jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data,!0)});for(var g=0,l,e;l=d[g];g++){e=!1;l=s?l:jQuery(l)[0];if("LINK"===l.tagName.toUpperCase()&&jQuery('link[rel="stylesheet"]').filter(function(){if(e||
this.href!==l.href)return!1;e=!0;jQuery.data(this,a.nss.data)&&jQuery.data(this,a.nss.data,!1);return!0}).length)continue;if("STYLE"===l.tagName.toUpperCase()&&jQuery("style").filter(function(){if(e||!jQuery.data(this,a.nss.data)||this.innerHTML!==l.innerHTML)return!1;e=!0;jQuery.data(this,a.nss.data,!1);return!0}).length)continue;jQuery.data(jQuery("head").append(l).children(":last-child")[0],a.nss.data,!1);l=null}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,
a.nss.data)}).remove();!1!==j(a.callbacks.update.css.after,b,[c,a.parameter,h,m,f])&&(a.speedcheck&&a.log.speed.name.push("css"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}},a.load.async||0);a.load.script&&setTimeout(function(){E("async")},a.load.async||0);var E=function(l){if(!1!==j(a.callbacks.update.script.before,b,[c,a.parameter,h,m,f])){var g=[];q=q?q:s?n.find("script").add(n.filter("script")):B(h,"(?:[^'\"]|^s*)(<script[^>]*?>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");
a.history.data[k].script=q;for(var e=0,d;d=q[e];e++)if(d=s?d:jQuery(d)[0],"sync"!==l||d.defer)if(!("async"===l&&d.defer)&&(d.childNodes.length||!(d.src in a.log.script)))d.src&&(a.log.script[d.src]=!0),jQuery.when?(d=d.src?jQuery.ajax(jQuery.extend(!0,{},a.ajax,{url:d.src,dataType:"script",global:!1})):jQuery.Deferred().resolve(d),g.push(d)):jQuery("head").append(d),d=null;jQuery.when&&g.length&&jQuery.when.apply(null,g).done(function(){for(var a=0,b;b=arguments[a];a++)0<Number(b.nodeType)&&eval((b.text||
b.textContent||b.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,"/*$0*/"))});j(a.callbacks.update.script.after,b,[c,a.parameter,h,m,f])}};a.load.script&&a.load.sync&&setTimeout(function(){jQuery(a.area).length===jQuery(a.area).children("."+a.nss.class4html+"-loaded").filter(function(){return this.clientWidth}).length?(jQuery(a.area).children("."+a.nss.class4html+"-loaded").remove(),setTimeout(function(){E("sync")},0),a.speedcheck&&a.log.speed.name.push("script"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-
a.log.speed.fire),a.speedcheck&&console.log(a.log.speed.time),a.speedcheck&&console.log(a.log.speed.name)):setTimeout(function(){arguments.callee()},a.interval)},0);-1<"click,submit".indexOf(c.type.toLowerCase())&&p.scrollTo(w,A);if((a.cache.click||a.cache.submit||a.cache.popstate)&&"POST"!==a.ajax.type&&!1!==j(a.callbacks.update.cache.save.before,b,[c,a.parameter,l])){var g=a.history,z;g.order.unshift(k);for(var r=1,t;t=g.order[r];r++)k===t&&g.order.splice(r,1);if(!l){z=2*h.length;g.size+=z;g.data[k]=
{data:null,dataType:m,XMLHttpRequest:f,title:x,size:z,timestamp:(new Date).getTime()};r=g.order.length-1;for(z=g.size;t=g.order[r];r--)if(r>=a.cache.length||g.size>a.cache.size||c.timeStamp>g.data[t].timestamp+a.cache.expire)g.order.pop(),g.size-=g.data[t].size,g.data[t]=null,delete g.data[t];a.history=g;j(a.callbacks.update.cache.save.after,b,[c,a.parameter,l])}}if(!1===j(a.callbacks.update.success,b,[c,a.parameter,h,m,f]))break a;if(!1===j(a.callbacks.update.complete,b,[c,a.parameter,h,m,f]))break a;
if(!1===j(a.callback,b,[c,a.parameter,h,m,f]))break a}catch(F){if(l){g=a.history;g.order.unshift(k);for(r=1;t=g.order[r];r++)k===t&&g.order.splice(r,1);r=g.order.length-1;for(z=g.size;t=g.order[r];r--)if(r>=a.cache.length||g.size>a.cache.size||c.timeStamp>g.data[t].timestamp+a.cache.expire)g.order.pop(),g.size-=g.data[t].size,g.data[t]=null,delete g.data[t];a.history=g}if(!1===j(a.callbacks.update.error,b,[c,a.parameter,h,m,f]))break a;if(!1===j(a.callbacks.update.complete,b,[c,a.parameter,h,m,f]))break a;
a.fallback&&D(c)}!1!==j(a.callbacks.update.after,b,[c,a.parameter,h,m,f])&&(a.speedcheck&&a.log.speed.name.push("end"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}}a.speedcheck&&(a.log.speed.fire=c.timeStamp);a.speedcheck&&(a.log.speed.time=[]);a.speedcheck&&(a.log.speed.name=[]);a.speedcheck&&a.log.speed.name.push("fire");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);if(!1===j(a.callbacks.before,b,[c,a.parameter]))return b;if(q)jQuery.when?jQuery.when(A(a.wait)).done(function(){u(q)}):
u(q);else{var h,m,f,d,n,v=[],s={dataFilter:function(f,d){h=f;m=d;return j(a.callbacks.ajax.dataFilter,b,[c,a.parameter,h,m])},complete:function(l,k){f=l;d=k;j(a.callbacks.ajax.complete,b,[c,a.parameter,f,d])}},w;for(w in s)w in a.callbacks.ajax||delete s[w];if("popstate"===c.type.toLowerCase()){if((v=k.match(/\?[^\s]*/))&&"?"!==v[0])a.ajax.type="GET";a.ajax.data=null}"submit"===c.type.toLowerCase()&&(k=k.replace(/\?[^\s]*/,""),a.ajax.type=jQuery(c.target).attr("method").toUpperCase(),"GET"===a.ajax.type&&
(k+="?"+jQuery(c.target).serialize(),a.ajax.data=null),"POST"===a.ajax.type&&(a.ajax.data=jQuery(c.target).serializeArray()));a.server.query&&(k=k.replace(/(#[^\s]*|)$/,(!k.match(/\?/)?"?":"&")+encodeURIComponent(a.server.query)+"=1$1"));a.speedcheck&&a.log.speed.name.push("ajax_start");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);jQuery.when?jQuery.when(A(a.wait),jQuery.ajax(jQuery.extend(!0,{},a.ajax,s,{url:k,beforeSend:function(d){f=d;f.setRequestHeader(a.nss.requestHeader,
"true");f.setRequestHeader(a.nss.requestHeader+"-Area",a.area);f.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);f.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);j(a.callbacks.ajax.beforeSend,b,[c,a.parameter,f])},success:function(d,k,e){h=d;m=k;f=e;j(a.callbacks.ajax.success,b,[c,a.parameter,h,m,f])},error:function(k,e,h){f=k;d=e;n=h;j(a.callbacks.ajax.error,b,[c,a.parameter,f,d,n]);a.fallback&&D(c)}}))).done(function(){u()}).fail().always():jQuery.ajax(jQuery.extend(!0,{},
a.ajax,s,{url:k,beforeSend:function(d){f=d;f.setRequestHeader(a.nss.requestHeader,"true");f.setRequestHeader(a.nss.requestHeader+"-Area",a.area);f.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);f.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);j(a.callbacks.ajax.beforeSend,b,[c,a.parameter,f])},success:function(d,k,e){h=d;m=k;f=e;j(a.callbacks.ajax.success,b,[c,a.parameter,h,m,f]);u()},error:function(k,e,h){f=k;d=e;n=h;j(a.callbacks.ajax.error,b,[c,a.parameter,f,d,n]);a.fallback&&
D(c)}}));if(!1===j(a.callbacks.after,b,[c,a.parameter]))return b}}function j(b,c,d){if("function"===typeof b)return b.apply(c,d)}function A(b){var c=jQuery.Deferred();if(!b)return c.resolve();setTimeout(function(){c.resolve()},b);return c.promise()}function D(b){"click"===b.type.toLowerCase()?p.location.href=b.currentTarget.href:"submit"===b.type.toLowerCase()?context.submit():"popstate"===b.type.toLowerCase()&&p.location.reload()}function B(b,c){var d=[];b.replace(RegExp(c,"gim"),function(b,a){d.push(a)});
return d}if("function"===typeof this)return arguments.callee.apply(jQuery(C),arguments);var q="object"===typeof window.validator?window.validator:!1;(q=q?q.clone({name:"jquery.pjax.js",base:!0}):q)&&q.start();q&&q.test(1,1,0,"plugin load");var u=jQuery.extend(!0,{},{id:0,gns:"pjax",ns:n,area:n,link:'a:not([target])[href^="/"]',form:n,scrollTop:0,scrollLeft:0,ajax:{},cache:{click:!1,submit:!1,popstate:!1,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},
content:{},css:{},script:{},cache:{load:{},save:{}}}},parameter:n,load:{css:!1,script:!1,sync:!0,async:0},interval:300,wait:0,fallback:!0,delay:500,server:{query:""},speedcheck:!1},v),d=[u.gns].concat(u.ns||[]);jQuery.extend(!0,u,{nss:{pjax:d.join("."),click:["click"].concat(d.join(":")).join("."),submit:["submit"].concat(d.join(":")).join("."),popstate:["popstate"].concat(d.join(":")).join("."),data:d.join(":"),class4html:d.join("-"),requestHeader:["X",d[0].replace(/^\w/,function(b){return b.toUpperCase()})].join("-"),
array:d},server:{query:u.server.query.length?u.server.query:u.gns},log:{script:{},speed:{}},history:{order:[],data:{},size:0},timestamp:(new Date).getTime(),disable:!1,speed:{now:function(){return(new Date).getTime()}}});if(!("pushState"in p.history&&null!==p.history.pushState)?0:jQuery(u.area).length){var e=u;e.id=s.length;s.push(e);e.link&&(e.form||jQuery(this).undelegate(e.link,e.nss.click).delegate(e.link,e.nss.click,e.id,function(b){b.timeStamp=(new Date).getTime();if(1<b.which||(b.metaKey||
b.ctrlKey||b.shiftKey||b.altKey)||(p.location.protocol!==this.protocol||p.location.host!==this.host)||p.location.pathname===this.pathname&&p.location.search===this.search&&p.location.hash!==this.hash)return this;var c,d,e;c=s[b.data];d=this.href;c.disable||(c.cache[b.type.toLowerCase()]&&(e=c.history.data[d]),e&&b.timeStamp>e.timestamp+c.cache.expire&&(e=n),w(this,b,d,d!==p.location.href,c,e),b.preventDefault())}));e.form&&jQuery(this).undelegate(e.form,e.nss.submit).delegate(e.form,e.nss.submit,
e.id,function(b){b.timeStamp=(new Date).getTime();var c,d,e;c=s[b.data];d=jQuery(b.target).attr("action");c.disable||(c.cache[b.type.toLowerCase()]&&(e=c.history.data[d]),e&&b.timeStamp>e.timestamp+c.cache.expire&&(e=n),w(this,b,d,!0,c,e),b.preventDefault())});jQuery(p).unbind(e.nss.popstate).bind(e.nss.popstate,e.id,function(b){b.timeStamp=(new Date).getTime();var c,d,e;c=s[b.data];d=p.location.href;c.disable||(c.cache[b.type.toLowerCase()]&&(e=c.history.data[d]),e&&b.timeStamp>e.timestamp+c.cache.expire&&
(e=n),!1!==c.timestamp&&c.delay>b.timeStamp-c.timestamp?c.timestamp=!1:(w(this,b,d,!1,c,e),b.preventDefault()))});jQuery("script[src]").each(function(){this.src in e.log.script||(e.log.script[this.src]=!0)})}q&&q.end();return this}if("undefined"!==typeof window.jQuery){jQuery=window.jQuery;var n=void 0,p=window,C=document,s=["settings"];jQuery.fn.pjax=v;jQuery.pjax=v;v=null}})();
