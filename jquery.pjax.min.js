/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.9.6
 * @updated 2013/05/04
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor Closure Compiler
 */
(function(){function x(w){function x(c,b,e,q,a,m){function v(r){j&&j.test("++",1,0,"update()");j&&(j.scope=function(a){return eval(a)});a:if(a.speedcheck&&a.log.speed.name.push("update_start"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),!1!==h(a.callbacks.update.before,c,[b,a.parameter,k,l,f])){try{if(!r&&-1===f.getResponseHeader("Content-Type").indexOf("text/html"))throw Error();var y,m,p;r&&!1!==h(a.callbacks.update.cache.load.before,c,[b,a.parameter,r])&&(f=r.XMLHttpRequest,
k=f.responseText,l=r.dataType,y=r.title,m=r.css,p=r.script,h(a.callbacks.update.cache.load.after,c,[b,a.parameter,r]));var n=jQuery(k),u=0<n.filter("title").length;y=y?y:u?n.filter("title").text():D(k,"<title>([^<]*)</title>");var x=a.area.split(","),z=null===a.scrollLeft?jQuery(d).scrollLeft():parseInt(a.scrollLeft),A=null===a.scrollTop?jQuery(d).scrollTop():parseInt(a.scrollTop);if(!jQuery(a.area).length||!n.find(a.area).add(n.filter(a.area)).length)throw Error();if(!1!==h(a.callbacks.update.url.before,
c,[b,a.parameter,k,l,f])){e=e.replace(RegExp("[?&]"+a.server.query+"=[^&#]*"),"");q&&d.history.pushState("pjax",d.opera||"userAgent"in d&&-1!==userAgent.indexOf("opera")?y:E.title,e);switch(!0){case /Mobile(\/\w+)? Safari/i.test(d.navigator.userAgent):a.disable=!0,d.history.back(),d.history.forward(),a.disable=!1}h(a.callbacks.update.url.after,c,[b,a.parameter,k,l,f])}!1!==h(a.callbacks.update.title.before,c,[b,a.parameter,k,l,f])&&(E.title=y,h(a.callbacks.update.title.after,c,[b,a.parameter,k,l,
f]));if(!1!==h(a.callbacks.update.content.before,c,[b,a.parameter,k,l,f])){for(var s=0,B;B=x[s];s++)jQuery(B).html(n.find(B).add(n.filter(B)).html()),a.load.script&&a.load.sync&&jQuery(B).append(jQuery("<div/>",{"class":a.nss.class4html+"-loaded",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax"));
h(a.callbacks.update.content.after,c,[b,a.parameter,k,l,f])}a.load.css&&setTimeout(function(){if(!1!==h(a.callbacks.update.css.before,c,[b,a.parameter,k,l,f])){m=m?m:u?n.find('link[rel="stylesheet"], style').add(n.filter('link[rel="stylesheet"], style')):D(k,'(<link[^>]*?rel="stylesheet"[^>]*?>|<style[^>]*?>(.|[\n\r])*?</style>)');a.history.data[e].css=m;jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data,!0)});for(var r=0,g,j;g=m[r];r++){j=!1;g=u?g:jQuery(g)[0];
if("LINK"===g.tagName.toUpperCase()&&jQuery('link[rel="stylesheet"]').filter(function(){if(j||this.href!==g.href)return!1;j=!0;jQuery.data(this,a.nss.data)&&jQuery.data(this,a.nss.data,!1);return!0}).length)continue;if("STYLE"===g.tagName.toUpperCase()&&jQuery("style").filter(function(){if(j||!jQuery.data(this,a.nss.data)||this.innerHTML!==g.innerHTML)return!1;j=!0;jQuery.data(this,a.nss.data,!1);return!0}).length)continue;jQuery.data(jQuery("head").append(g).children(":last-child")[0],a.nss.data,
!1);g=null}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data)}).remove();!1!==h(a.callbacks.update.css.after,c,[b,a.parameter,k,l,f])&&(a.speedcheck&&a.log.speed.name.push("css"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}},a.load.async||0);a.load.script&&setTimeout(function(){C("async")},a.load.async||0);var C=function(g){if(!1!==h(a.callbacks.update.script.before,c,[b,a.parameter,k,l,f])){var r=[];p=p?p:u?n.find("script").add(n.filter("script")):
D(k,"(?:[^'\"]|^s*)(<script[^>]*?>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");a.history.data[e].script=p;for(var j=0,d;d=p[j];j++)if(d=u?d:jQuery(d)[0],"sync"!==g||d.defer)if(!("async"===g&&d.defer)&&(d.childNodes.length||!(d.src in a.log.script)))d.src&&(a.log.script[d.src]=!0),jQuery.when?(d=d.src?jQuery.ajax(jQuery.extend(!0,{},a.ajax,{url:d.src,dataType:"script",async:!1,global:!1})):jQuery.Deferred().resolve(d),r.push(d)):jQuery("head").append(d),d=null;jQuery.when&&r.length&&jQuery.when.apply(null,
r).done(function(){for(var a=0,b;b=arguments[a];a++)0<Number(b.nodeType)&&eval((b.text||b.textContent||b.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,"/*$0*/"))});h(a.callbacks.update.script.after,c,[b,a.parameter,k,l,f])}};a.load.script&&a.load.sync&&setTimeout(function(){jQuery(a.area).length===jQuery(a.area).children("."+a.nss.class4html+"-loaded").filter(function(){return this.clientWidth}).length?(jQuery(a.area).children("."+a.nss.class4html+"-loaded").remove(),setTimeout(function(){C("sync")},
0),a.speedcheck&&a.log.speed.name.push("script"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),a.speedcheck&&console.log(a.log.speed.time),a.speedcheck&&console.log(a.log.speed.name)):setTimeout(function(){arguments.callee()},a.interval)},0);-1<"click,submit".indexOf(b.type.toLowerCase())&&d.scrollTo(z,A);if((a.cache.click||a.cache.submit||a.cache.popstate)&&"POST"!==a.ajax.type&&!1!==h(a.callbacks.update.cache.save.before,c,[b,a.parameter,r])){var g=a.history;g.order.unshift(e);
for(var s=1,t;t=g.order[s];s++)e===t&&g.order.splice(s,1);if(!r){w=w||2*k.length;g.size+=w;g.data[e]={data:null,dataType:l,XMLHttpRequest:f,title:y,size:w,timestamp:(new Date).getTime()};for(s=g.order.length-1;t=g.order[s];s--)if(s>=a.cache.length||g.size>a.cache.size||b.timeStamp>g.data[t].timestamp+a.cache.expire)g.order.pop(),g.size-=g.data[t].size,g.data[t]=null,delete g.data[t];a.history=g;h(a.callbacks.update.cache.save.after,c,[b,a.parameter,r])}}if(!1===h(a.callbacks.update.success,c,[b,a.parameter,
k,l,f]))break a;if(!1===h(a.callbacks.update.complete,c,[b,a.parameter,k,l,f]))break a;if(!1===h(a.callback,c,[b,a.parameter,k,l,f]))break a;j&&j.test("++",1,0,"update: success")}catch(G){if(r){g=a.history;g.order.unshift(e);for(s=1;t=g.order[s];s++)e===t&&g.order.splice(s,1);for(s=g.order.length-1;t=g.order[s];s--)if(s>=a.cache.length||g.size>a.cache.size||b.timeStamp>g.data[t].timestamp+a.cache.expire)g.order.pop(),g.size-=g.data[t].size,g.data[t]=null,delete g.data[t];a.history=g}if(!1===h(a.callbacks.update.error,
c,[b,a.parameter,k,l,f]))break a;if(!1===h(a.callbacks.update.complete,c,[b,a.parameter,k,l,f]))break a;j&&j.test("++",1,[e,location.href],"update: error");if(a.fallback)return F(b)}!1!==h(a.callbacks.update.after,c,[b,a.parameter,k,l,f])&&(a.speedcheck&&a.log.speed.name.push("end"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),j&&j.test("++","url === location.href",[e,location.href],"update: is updated"),j&&j.end())}}var j=u[a.id]&&u[a.id].validate?u[a.id].validate.clone({name:"jquery.pjax.js :drive()"}):
j;j&&j.start();j&&(j.scope=function(a){return eval(a)});j&&j.test(1,1,0,"drive()");a.speedcheck&&(a.log.speed.fire=b.timeStamp);a.speedcheck&&(a.log.speed.time=[]);a.speedcheck&&(a.log.speed.name=[]);a.speedcheck&&a.log.speed.name.push("fire");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);if(!1===h(a.callbacks.before,c,[b,a.parameter]))return c;if(m)jQuery.when?jQuery.when(C(a.wait)).done(function(){v(m)}):v(m);else{var k,l,f,p,n,w,G=[],z={xhr:function(){f=h(a.callbacks.ajax.xhr,
c,[b,a.parameter]);f=f instanceof d.XMLHttpRequest?f:jQuery.ajaxSettings.xhr();f instanceof d.XMLHttpRequest&&f.addEventListener("progress",function(a){w=a.loaded},!1);return f},dataFilter:function(f,e){k=f;l=e;return h(a.callbacks.ajax.dataFilter,c,[b,a.parameter,k,l])||k},complete:function(e,d){f=e;p=d;h(a.callbacks.ajax.complete,c,[b,a.parameter,f,p])}},A;for(A in z)A in a.callbacks.ajax||"xhr"===A||delete z[A];if("popstate"===b.type.toLowerCase()){if((G=e.match(/\?[^\s]*/))&&"?"!==G[0])a.ajax.type=
"GET";a.ajax.data=null}"submit"===b.type.toLowerCase()&&(e=e.replace(/\?[^\s]*/,""),a.ajax.type=jQuery(b.target).attr("method").toUpperCase(),"GET"===a.ajax.type&&(e+="?"+jQuery(b.target).serialize(),a.ajax.data=null),"POST"===a.ajax.type&&(a.ajax.data=jQuery(b.target).serializeArray()));a.server.query&&(e=e.replace(/(#[^\s]*|)$/,(!e.match(/\?/)?"?":"&")+encodeURIComponent(a.server.query)+"=1$1"));a.speedcheck&&a.log.speed.name.push("ajax_start");a.speedcheck&&a.log.speed.time.push(a.speed.now()-
a.log.speed.fire);jQuery.when?jQuery.when(C(a.wait),jQuery.ajax(jQuery.extend(!0,{},a.ajax,z,{url:e,beforeSend:function(e){f=e;f.setRequestHeader(a.nss.requestHeader,"true");f.setRequestHeader(a.nss.requestHeader+"-Area",a.area);f.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);f.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);h(a.callbacks.ajax.beforeSend,c,[b,a.parameter,f])},success:function(e,d,j){k=e;l=d;f=j;h(a.callbacks.ajax.success,c,[b,a.parameter,k,l,f])},error:function(d,
k,l){f=d;p=k;n=l;h(a.callbacks.ajax.error,c,[b,a.parameter,f,p,n]);j&&j.test("++",1,[e,location.href],"ajax error");j&&j.end();if(a.fallback)return F(b)}}))).done(function(){v()}).fail().always():jQuery.ajax(jQuery.extend(!0,{},a.ajax,z,{url:e,beforeSend:function(e){f=e;f.setRequestHeader(a.nss.requestHeader,"true");f.setRequestHeader(a.nss.requestHeader+"-Area",a.area);f.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);f.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);h(a.callbacks.ajax.beforeSend,
c,[b,a.parameter,f])},success:function(e,d,j){k=e;l=d;f=j;h(a.callbacks.ajax.success,c,[b,a.parameter,k,l,f]);v()},error:function(d,k,l){f=d;p=k;n=l;h(a.callbacks.ajax.error,c,[b,a.parameter,f,p,n]);j&&j.test("++",1,[e,location.href],"ajax error");j&&j.end();if(a.fallback)return F(b)}}));if(!1===h(a.callbacks.after,c,[b,a.parameter]))return c}}function h(c,b,e){if("function"===typeof c)return c.apply(b,e)}function C(c){var b=jQuery.Deferred();if(!c)return b.resolve();setTimeout(function(){b.resolve()},
c);return b.promise()}function F(c){"click"===c.type.toLowerCase()?d.location.href=c.currentTarget.href:"submit"===c.type.toLowerCase()?context.submit():"popstate"===c.type.toLowerCase()&&d.location.reload()}function D(c,b){var e=[];c.replace(RegExp(b,"gim"),function(b,a){e.push(a)});return e}if("function"===typeof this)return arguments.callee.apply(jQuery(E),arguments);var m="object"===typeof window.validator?window.validator:!1;(m=m?m.clone({name:"jquery.pjax.js",base:!0,timeout:{limit:w&&w.ajax&&
w.ajax.timeout?w.ajax.timeout+m.timeout.limit:m.timeout.limit}}):m)&&m.start();m&&m.test(1,1,0,"plugin load");var v=jQuery.extend(!0,{},{id:0,gns:"pjax",ns:n,area:n,link:'a:not([target])[href^="/"]',form:n,scrollTop:0,scrollLeft:0,ajax:{},cache:{click:!1,submit:!1,popstate:!1,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},content:{},css:{},script:{},cache:{load:{},save:{}}}},parameter:n,load:{css:!1,script:!1,sync:!0,async:0},interval:300,wait:0,
fallback:!0,server:{query:""},speedcheck:!1},w),p=[v.gns].concat(v.ns||[]);jQuery.extend(!0,v,{nss:{pjax:p.join("."),click:["click"].concat(p.join(":")).join("."),submit:["submit"].concat(p.join(":")).join("."),popstate:["popstate"].concat(p.join(":")).join("."),data:p.join(":"),class4html:p.join("-"),requestHeader:["X",p[0].replace(/^\w/,function(c){return c.toUpperCase()})].join("-"),array:p},server:{query:v.server.query.length?v.server.query:v.gns},log:{script:{},speed:{}},history:{order:[],data:{},
size:0},timestamp:(new Date).getTime(),disable:!1,landing:location.href,validate:m,speed:{now:function(){return(new Date).getTime()}}});if(!("pushState"in d.history&&null!==d.history.pushState)?0:jQuery(v.area).length){var q=v;q.id=u.length;u.push(q);q.link&&(q.form||jQuery(this).undelegate(q.link,q.nss.click).delegate(q.link,q.nss.click,q.id,function(c){c.timeStamp=(new Date).getTime();if(1<c.which||(c.metaKey||c.ctrlKey||c.shiftKey||c.altKey)||(d.location.protocol!==this.protocol||d.location.host!==
this.host)||d.location.pathname===this.pathname&&d.location.search===this.search&&d.location.hash!==this.hash)return this;var b,e,h;b=u[c.data];e=this.href;b.disable||(b.cache[c.type.toLowerCase()]&&(h=b.history.data[e]),h&&c.timeStamp>h.timestamp+b.cache.expire&&(h=n),b.landing&&(b.landing=!1),x(this,c,e,e!==d.location.href,b,h),c.preventDefault())}));q.form&&jQuery(this).undelegate(q.form,q.nss.submit).delegate(q.form,q.nss.submit,q.id,function(c){c.timeStamp=(new Date).getTime();var b,e,d;b=u[c.data];
e=jQuery(c.target).attr("action");b.disable||(b.cache[c.type.toLowerCase()]&&(d=b.history.data[e]),d&&c.timeStamp>d.timestamp+b.cache.expire&&(d=n),b.landing&&(b.landing=!1),x(this,c,e,!0,b,d),c.preventDefault())});jQuery(d).unbind(q.nss.popstate).bind(q.nss.popstate,q.id,function(c){c.timeStamp=(new Date).getTime();var b,e,h;b=u[c.data];e=d.location.href;if(!b.disable){b.cache[c.type.toLowerCase()]&&(h=b.history.data[e]);h&&c.timeStamp>h.timestamp+b.cache.expire&&(h=n);if(b.landing){if(b.landing===
location.href){b.landing=!1;return}b.landing=!1}x(this,c,e,!1,b,h)}});jQuery("script[src]").each(function(){this.src in q.log.script||(q.log.script[this.src]=!0)})}m&&m.end();return this}if("undefined"!==typeof window.jQuery){jQuery=window.jQuery;var n=void 0,d=window,E=document,u=["settings"];jQuery.fn.pjax=x;jQuery.pjax=x;x=null}})();
