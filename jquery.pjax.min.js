/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.7.4
 * @updated 2013/04/16
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor Closure Compiler
 */
(function(){function p(p){function s(g,c,b,p,a){function s(){a:if(a.speed.check?a.speed.log.name.push("update_start"):null,a.speed.check?a.speed.log.time.push(a.speed.now()-a.speed.log.fire):null,!1!==f(a.callbacks.update.before,g,[c,a.parameter,e,j,d])){try{if(-1===d.getResponseHeader("Content-Type").indexOf("text/html"))throw Error();var m=jQuery(e),v=0<m.filter("title").length,h=v?m.filter("title").text():A(e,"<title>([^<]*)</title>"),n,r,t=a.area.split(","),u=null===a.scrollLeft?jQuery(q).scrollLeft():
parseInt(a.scrollLeft),z=null===a.scrollTop?jQuery(q).scrollTop():parseInt(a.scrollTop);if(!jQuery(a.area).length||!m.find(a.area).add(m.filter(a.area)).length)throw Error();!1!==f(a.callbacks.update.url.before,g,[c,a.parameter,e,j,d])&&(b=b.replace(RegExp("[?&]"+a.server.query+"=.*?([sW#&]|$)"),""),p?history.pushState(null,q.opera||"userAgent"in q&&-1!==userAgent.indexOf("opera")?h:B.title,b):null,f(a.callbacks.update.url.after,g,[c,a.parameter,e,j,d]));!1!==f(a.callbacks.update.title.before,g,[c,
a.parameter,e,j,d])&&(B.title=h,f(a.callbacks.update.title.after,g,[c,a.parameter,e,j,d]));if(!1!==f(a.callbacks.update.content.before,g,[c,a.parameter,e,j,d])){for(var h=0,w;w=t[h];h++)jQuery(w).html(m.find(w).add(m.filter(w)).html()),a.load.script&&a.load.sync?jQuery(w).append(jQuery("<div/>",{"class":a.nss.class4html+"-loaded",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax")):
null;f(a.callbacks.update.content.after,g,[c,a.parameter,e,j,d])}a.load.css?setTimeout(function(){if(!1!==f(a.callbacks.update.css.before,g,[c,a.parameter,e,j,d])){n=v?m.find('link[rel="stylesheet"], style').add(m.filter('link[rel="stylesheet"], style')):A(e,'(<link[^>]*?rel="stylesheet"[^>]*?>|<style[^>]*?>(.|[\n\r])*?</style>)');jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data,!0)});for(var b=0,h,l;h=n[b];b++){l=!1;h=v?h:jQuery(h)[0];if("LINK"===h.tagName.toUpperCase()&&
jQuery('link[rel="stylesheet"]').filter(function(){if(l||this.href!==h.href)return!1;l=!0;jQuery.data(this,a.nss.data)?jQuery.data(this,a.nss.data,!1):null;return!0}).length)continue;if("STYLE"===h.tagName.toUpperCase()&&jQuery("style").filter(function(){if(l||!jQuery.data(this,a.nss.data)||this.innerHTML!==h.innerHTML)return!1;l=!0;jQuery.data(this,a.nss.data,!1);return!0}).length)continue;jQuery.data(jQuery("head").append(h).children(":last-child")[0],a.nss.data,!1);h=null}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,
a.nss.data)}).remove();!1!==f(a.callbacks.update.css.after,g,[c,a.parameter,e,j,d])&&(a.speed.check?a.speed.log.name.push("css"):null,a.speed.check?a.speed.log.time.push(a.speed.now()-a.speed.log.fire):null)}},a.load.async||0):null;a.load.script?setTimeout(function(){y("async")},a.load.async||0):null;var y=function(b){if(!1!==f(a.callbacks.update.script.before,g,[c,a.parameter,e,j,d])){r=v?m.find("script").add(m.filter("script")):A(e,"(?:[^'\"]|^s*)(<script[^>]*?>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");
for(var h=0,l,k;l=r[h];h++)if(k=!1,l=v?l:jQuery(l)[0],!a.load.sync||"sync"!==b||l.defer)if((!a.load.sync||!("async"===b&&l.defer))&&!jQuery("script[src]").filter(function(){return k||this.src!==l.src?!1:k=!0}).length)jQuery.data(jQuery("head").append(l).children(":last-child")[0],a.nss.data,!1),l=null;f(a.callbacks.update.script.after,g,[c,a.parameter,e,j,d])}};if(a.load.script&&a.load.sync){var x=setTimeout(function(){for(;x=a.queue.shift();)clearTimeout(x);jQuery(a.area).length===jQuery(a.area).children("."+
a.nss.class4html+"-loaded").filter(function(){return this.clientWidth}).length?(jQuery(a.area).children("."+a.nss.class4html+"-loaded").remove(),setTimeout(function(){y("sync")},0),a.speed.check?a.speed.log.name.push("script"):null,a.speed.check?a.speed.log.time.push(a.speed.now()-a.speed.log.fire):null,a.speed.check?console.log(a.speed.log.time):null,a.speed.check?console.log(a.speed.log.name):null,a.speed.check?console.log(a.speed.log.retry):null):(x=setTimeout(arguments.callee,a.interval),a.queue.push(x),
a.speed.check?++a.speed.log.retry:null);k[a.id]=a},0);a.queue.push(x);k[a.id]=a}p&&-1<"click,submit".indexOf(c.type.toLowerCase())?q.scrollTo(u,z):null;if(!1===f(a.callbacks.update.success,g,[c,a.parameter,e,j,d]))break a;if(!1===f(a.callbacks.update.complete,g,[c,a.parameter,e,j,d]))break a;if(!1===f(a.callback,g,[c,a.parameter,e,j,d]))break a}catch(D){if(!1===f(a.callbacks.update.error,g,[c,a.parameter,e,j,d]))break a;if(!1===f(a.callbacks.update.complete,g,[c,a.parameter,e,j,d]))break a;a.fallback?
C(c):null}!1!==f(a.callbacks.update.after,g,[c,a.parameter,e,j,d])&&(a.speed.check?a.speed.log.name.push("end"):null,a.speed.check?a.speed.log.time.push(a.speed.now()-a.speed.log.fire):null)}}var e,j,d,n,t,z=[],u={dataFilter:function(b,d){e=b;j=d;return f(a.callbacks.ajax.dataFilter,g,[c,a.parameter,e,j])},complete:function(b,e){d=b;n=e;f(a.callbacks.ajax.complete,g,[c,a.parameter,d,n])}};a.speed.check?a.speed.log.fire=c.timeStamp:null;a.speed.check?a.speed.log.time=[]:null;a.speed.check?a.speed.log.name=
[]:null;a.speed.check?a.speed.log.name.push("fire"):null;a.speed.check?a.speed.log.time.push(a.speed.now()-a.speed.log.fire):null;for(var y in u)y in a.callbacks.ajax||delete u[y];if("popstate"===c.type.toLowerCase()){if((z=b.match(/\?[^\s]*/))&&"?"!==z[0])a.ajax.type="GET";a.ajax.data=null}"submit"===c.type.toLowerCase()&&(b=b.replace(/\?[^\s]*/,""),a.ajax.type=jQuery(c.target).attr("method").toUpperCase(),"GET"===a.ajax.type&&(b+="?"+jQuery(c.target).serialize(),a.ajax.data=null),"POST"===a.ajax.type&&
(a.ajax.data=jQuery(c.target).serializeArray()));a.server.query&&(b=b.replace(/(#[^\s]*|)$/,(!b.match(/\?/)?"?":"&")+encodeURIComponent(a.server.query)+"=1$1"));if(!1===f(a.callbacks.before,g,[c,a.parameter]))return g;a.speed.check?a.speed.log.name.push("ajax_start"):null;a.speed.check?a.speed.log.time.push(a.speed.now()-a.speed.log.fire):null;jQuery.when!==r?jQuery.when(D(a.wait),jQuery.ajax(jQuery.extend(!0,{},a.ajax,u,{url:b,beforeSend:function(b){d=b;d.setRequestHeader(a.nss.requestHeader,"true");
d.setRequestHeader(a.nss.requestHeader+"-Area",a.area);d.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);d.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);f(a.callbacks.ajax.beforeSend,g,[c,a.parameter,d])},success:function(b,k,h){e=b;j=k;d=h;f(a.callbacks.ajax.success,g,[c,a.parameter,e,j,d])},error:function(b,e,h){d=b;n=e;t=h;f(a.callbacks.ajax.error,g,[c,a.parameter,d,n,t]);a.fallback?C(c):null}}))).done(function(){s()}).fail().always():jQuery.ajax(jQuery.extend(!0,{},a.ajax,
u,{url:b,beforeSend:function(b){d=b;d.setRequestHeader(a.nss.requestHeader,"true");d.setRequestHeader(a.nss.requestHeader+"-Area",a.area);d.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);d.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);f(a.callbacks.ajax.beforeSend,g,[c,a.parameter,d])},success:function(b,k,h){e=b;j=k;d=h;f(a.callbacks.ajax.success,g,[c,a.parameter,e,j,d]);s()},error:function(b,e,h){d=b;n=e;t=h;f(a.callbacks.ajax.error,g,[c,a.parameter,d,n,t]);a.fallback?C(c):
null}}));if(!1===f(a.callbacks.after,g,[c,a.parameter]))return g;c.preventDefault()}function f(b,c,f){if("function"===typeof b)return b.apply(c,f)}function D(b){var c=jQuery.Deferred();if(!b)return c.resolve();setTimeout(function(){c.resolve()},b);return c.promise()}function C(b){"click"===b.type.toLowerCase()?location.href=b.currentTarget.href:"submit"===b.type.toLowerCase()?context.submit():"popstate"===b.type.toLowerCase()&&location.reload()}function A(b,c){var f=[];b.replace(RegExp(c,"gim"),function(b,
a){f.push(a)});return f}if("function"===typeof this)return arguments.callee.apply(jQuery(B),arguments);var b=jQuery.extend(!0,{},{id:0,gns:"pjax",ns:r,area:r,link:'a:not([target])[href^="/"]',form:r,scrollTop:0,scrollLeft:0,ajax:{},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},content:{},css:{},script:{}}},parameter:r,load:{css:!1,script:!1,sync:!0,async:0},interval:300,queue:[],wait:0,fallback:!0,server:{query:"pjax"},delay:500,speed:{check:!1}},p);jQuery.extend(!0,b,{nss:{class4html:""+
(b.gns+(b.ns?"-"+b.ns:"")),click:["click",b.gns+(b.ns?":"+b.ns:"")].join("."),submit:["submit",b.gns+(b.ns?":"+b.ns:"")].join("."),popstate:["popstate",b.gns+(b.ns?":"+b.ns:"")].join("."),data:b.gns+(b.ns?":"+b.ns:""),requestHeader:["X",b.gns.replace(/^(\w)/,function(b){return b.toUpperCase()})].join("-")},timestamp:(new Date).getTime(),speed:{now:function(){return(new Date).getTime()},log:{retry:0}}});if(!(!("pushState"in q.history&&null!==q.history.pushState)?0:jQuery(b.area).length))return this;
b.id=k.length;k.push(b);b.link&&(b.form||jQuery(this).undelegate(b.link,b.nss.click).delegate(b.link,b.nss.click,b.id,function(b){if(1<b.which||(b.metaKey||b.ctrlKey||b.shiftKey||b.altKey)||(location.protocol!==this.protocol||location.host!==this.host)||location.pathname===this.pathname&&location.search===this.search&&location.hash!==this.hash)return this;s(this,b,this.href,location.href!==this.href,k[b.data])}));b.form&&jQuery(this).undelegate(b.form,b.nss.submit).delegate(b.form,b.nss.submit,b.id,
function(b){s(this,b,jQuery(b.target).attr("action"),!0,k[b.data])});jQuery(q).unbind(b.nss.popstate).bind(b.nss.popstate,b.id,function(b){var c=k[b.data];!1!==c.timestamp&&c.delay>b.timeStamp-c.timestamp?(c.timestamp=!1,k[c.id]=c):s(this,b,location.href,!1,k[b.data])});return this}if("undefined"!==typeof window.jQuery){jQuery=window.jQuery;var r=void 0,q=window,B=document,k=["settings"];jQuery.fn.pjax=p;jQuery.pjax=p;p=null}})();
