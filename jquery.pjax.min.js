/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.10.0
 * @updated 2013/05/07
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor Closure Compiler
 */
(function(){function x(u){function x(c,b,k,F,a,e){function t(r){m&&m.test("++",1,0,"update()");m&&(m.scope=function(a){return eval(a)});a:if(a.speedcheck&&a.log.speed.name.push("update_start"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),!1!==h(a.callbacks.update.before,c,[b,a.parameter,j,l,f])){try{if(!r&&!RegExp(a.contentType.replace(/\s*[,;]\s*/g,"|"),"i").test(f.getResponseHeader("Content-Type")))throw Error();var e,n,q;r&&!1!==h(a.callbacks.update.cache.load.before,c,[b,
a.parameter,r])&&(f=r.XMLHttpRequest,j=f.responseText,l=r.dataType,e=r.title,n=r.css,q=r.script,h(a.callbacks.update.cache.load.after,c,[b,a.parameter,r]));var p=jQuery(j),u=0<p.filter("title").length,x=a.area.split(","),y=null===a.scrollLeft?jQuery(d).scrollLeft():parseInt(a.scrollLeft),z=null===a.scrollTop?jQuery(d).scrollTop():parseInt(a.scrollTop);e=e?e:u?p.filter("title").text():jQuery("<span/>").html(C(j,"<title>([^<]*)</title>").join()).text();if(!jQuery(a.area).length||!p.find(a.area).add(p.filter(a.area)).length)throw Error();
if(!1!==h(a.callbacks.update.url.before,c,[b,a.parameter,j,l,f])){k=k.replace(RegExp("[?&]"+a.server.query+"=[^&#]*"),"");F&&d.history.pushState(a.gns,d.opera||-1!==d.navigator.userAgent.toLowerCase().indexOf("opera")?e:D.title,k);switch(!0){case /Mobile(\/\w+)? Safari/i.test(d.navigator.userAgent):d.history.back(),d.history.forward()}h(a.callbacks.update.url.after,c,[b,a.parameter,j,l,f])}!1!==h(a.callbacks.update.title.before,c,[b,a.parameter,j,l,f])&&(D.title=e,h(a.callbacks.update.title.after,
c,[b,a.parameter,j,l,f]));if(!1!==h(a.callbacks.update.content.before,c,[b,a.parameter,j,l,f])){for(var s=0,A;A=x[s];s++)jQuery(A).html(p.find(A).add(p.filter(A)).children()),a.load.script&&a.load.sync&&jQuery(A).append(jQuery("<div/>",{"class":a.nss.class4html+"-loaded",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax"));
h(a.callbacks.update.content.after,c,[b,a.parameter,j,l,f])}a.load.css&&setTimeout(function(){if(!1!==h(a.callbacks.update.css.before,c,[b,a.parameter,j,l,f])){n=n?n:u?p.find('link[rel="stylesheet"], style').add(p.filter('link[rel="stylesheet"], style')):C(j,'(<link[^>]*?rel="stylesheet"[^>]*?>|<style[^>]*?>(.|[\n\r])*?</style>)');a.history.data[k].css=n;jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data,!0)});for(var r=0,g,e;g=n[r];r++){e=!1;g=u?g:jQuery(g)[0];
if("LINK"===g.tagName.toUpperCase()&&jQuery('link[rel="stylesheet"]').filter(function(){if(e||this.href!==g.href)return!1;e=!0;jQuery.data(this,a.nss.data)&&jQuery.data(this,a.nss.data,!1);return!0}).length)continue;if("STYLE"===g.tagName.toUpperCase()&&jQuery("style").filter(function(){if(e||!jQuery.data(this,a.nss.data)||this.innerHTML!==g.innerHTML)return!1;e=!0;jQuery.data(this,a.nss.data,!1);return!0}).length)continue;jQuery.data(jQuery("head").append(g).children(":last-child")[0],a.nss.data,
!1);g=null}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data)}).remove();!1!==h(a.callbacks.update.css.after,c,[b,a.parameter,j,l,f])&&(a.speedcheck&&a.log.speed.name.push("css"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}},a.load.async||0);a.load.script&&setTimeout(function(){B("async")},a.load.async||0);var B=function(g){if(!1!==h(a.callbacks.update.script.before,c,[b,a.parameter,j,l,f])){var e=[];q=q?q:u?p.find("script").add(p.filter("script")):
C(j,"(?:[^'\"]|^s*)(<script[^>]*?>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");a.history.data[k].script=q;for(var r=0,d;d=q[r];r++)if(d=u?d:jQuery(d)[0],"sync"!==g||d.defer)if(!("async"===g&&d.defer)&&(d.childNodes.length||!(d.src in a.log.script)))d.src&&(a.log.script[d.src]=!0),jQuery.when?(d=d.src?jQuery.ajax(jQuery.extend(!0,{},a.ajax,{url:d.src,dataType:"script",async:!1,global:!1})):jQuery.Deferred().resolve(d),e.push(d)):jQuery("head").append(d),d=null;jQuery.when&&e.length&&jQuery.when.apply(null,
e).done(function(){for(var a=0,b;b=arguments[a];a++)0<Number(b.nodeType)&&eval((b.text||b.textContent||b.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,"/*$0*/"))});h(a.callbacks.update.script.after,c,[b,a.parameter,j,l,f])}};a.load.script&&a.load.sync&&setTimeout(function(){jQuery(a.area).length===jQuery(a.area).children("."+a.nss.class4html+"-loaded").filter(function(){return this.clientWidth}).length?(jQuery(a.area).children("."+a.nss.class4html+"-loaded").remove(),setTimeout(function(){B("sync")},
0),a.speedcheck&&a.log.speed.name.push("script"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),a.speedcheck&&console.log(a.log.speed.time),a.speedcheck&&console.log(a.log.speed.name)):setTimeout(function(){arguments.callee()},a.interval)},0);-1<"click,submit".indexOf(b.type.toLowerCase())&&d.scrollTo(y,z);if((a.cache.click||a.cache.submit||a.cache.popstate)&&"POST"!==a.ajax.type&&!1!==h(a.callbacks.update.cache.save.before,c,[b,a.parameter,r])){var g=a.history;g.order.unshift(k);
for(var s=1,v;v=g.order[s];s++)k===v&&g.order.splice(s,1);if(!r){w=w||2*j.length;g.size+=w;g.data[k]={data:null,dataType:l,XMLHttpRequest:f,title:e,size:w,timestamp:(new Date).getTime()};for(s=g.order.length-1;v=g.order[s];s--)if(s>=a.cache.length||g.size>a.cache.size||b.timeStamp>g.data[v].timestamp+a.cache.expire)g.order.pop(),g.size-=g.data[v].size,g.data[v]=null,delete g.data[v];a.history=g;h(a.callbacks.update.cache.save.after,c,[b,a.parameter,r])}}if(!1===h(a.callbacks.update.success,c,[b,a.parameter,
j,l,f]))break a;if(!1===h(a.callbacks.update.complete,c,[b,a.parameter,j,l,f]))break a;if(!1===h(a.callback,c,[b,a.parameter,j,l,f]))break a;m&&m.test("++",1,0,"update: success")}catch(G){if(r){g=a.history;g.order.unshift(k);for(s=1;v=g.order[s];s++)k===v&&g.order.splice(s,1);for(s=g.order.length-1;v=g.order[s];s--)if(s>=a.cache.length||g.size>a.cache.size||b.timeStamp>g.data[v].timestamp+a.cache.expire)g.order.pop(),g.size-=g.data[v].size,g.data[v]=null,delete g.data[v];a.history=g}if(!1===h(a.callbacks.update.error,
c,[b,a.parameter,j,l,f]))break a;if(!1===h(a.callbacks.update.complete,c,[b,a.parameter,j,l,f]))break a;m&&m.test("++",1,[k,d.location.href],"update: error");if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):E(b)}!1!==h(a.callbacks.update.after,c,[b,a.parameter,j,l,f])&&(a.on(),a.speedcheck&&a.log.speed.name.push("end"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),m&&m.test("++","url === win.location.href",[k,d.location.href],"update: is updated"),m&&m.end())}}
var m=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js :drive()"}):m;m&&m.start();m&&(m.scope=function(a){return eval(a)});m&&m.test(1,1,0,"drive()");a.speedcheck&&(a.log.speed.fire=b.timeStamp);a.speedcheck&&(a.log.speed.time=[]);a.speedcheck&&(a.log.speed.name=[]);a.speedcheck&&a.log.speed.name.push("fire");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);if(!1===h(a.callbacks.before,c,[b,a.parameter]))return c;if(e)jQuery.when?jQuery.when(B(a.wait)).done(function(){t(e)}):
t(e);else{var j,l,f,n,q,w,u=[],y={xhr:function(){f=h(a.callbacks.ajax.xhr,c,[b,a.parameter]);f=f instanceof d.XMLHttpRequest?f:jQuery.ajaxSettings.xhr();f instanceof d.XMLHttpRequest&&f.addEventListener("progress",function(a){w=a.loaded},!1);return f},dataFilter:function(f,d){j=f;l=d;return h(a.callbacks.ajax.dataFilter,c,[b,a.parameter,j,l])||j},complete:function(d,k){f=d;n=k;h(a.callbacks.ajax.complete,c,[b,a.parameter,f,n])}},z;for(z in y)z in a.callbacks.ajax||"xhr"===z||delete y[z];if("popstate"===
b.type.toLowerCase()){if((u=k.match(/\?[^\s]*/))&&"?"!==u[0])a.ajax.type="GET";a.ajax.data=null}"submit"===b.type.toLowerCase()&&(k=k.replace(/\?[^\s]*/,""),a.ajax.type=jQuery(b.target).attr("method").toUpperCase(),"GET"===a.ajax.type&&(k+="?"+jQuery(b.target).serialize(),a.ajax.data=null),"POST"===a.ajax.type&&(a.ajax.data=jQuery(b.target).serializeArray()));a.server.query&&(k=k.replace(/(#[^\s]*|)$/,(!k.match(/\?/)?"?":"&")+encodeURIComponent(a.server.query)+"=1$1"));a.speedcheck&&a.log.speed.name.push("ajax_start");
a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);jQuery.when?jQuery.when(B(a.wait),jQuery.ajax(jQuery.extend(!0,{},a.ajax,y,{url:k,beforeSend:function(d){f=d;f.setRequestHeader(a.nss.requestHeader,"true");f.setRequestHeader(a.nss.requestHeader+"-Area",a.area);f.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);f.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);h(a.callbacks.ajax.beforeSend,c,[b,a.parameter,f])},success:function(d,k,e){j=d;l=k;f=e;h(a.callbacks.ajax.success,
c,[b,a.parameter,j,l,f])},error:function(e,j,l){f=e;n=j;q=l;h(a.callbacks.ajax.error,c,[b,a.parameter,f,n,q]);m&&m.test("++",1,[k,d.location.href],"ajax error");m&&m.end();if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):E(b)}}))).done(function(){t()}).fail().always():jQuery.ajax(jQuery.extend(!0,{},a.ajax,y,{url:k,beforeSend:function(d){f=d;f.setRequestHeader(a.nss.requestHeader,"true");f.setRequestHeader(a.nss.requestHeader+"-Area",a.area);f.setRequestHeader(a.nss.requestHeader+
"-CSS",a.load.css);f.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);h(a.callbacks.ajax.beforeSend,c,[b,a.parameter,f])},success:function(d,k,e){j=d;l=k;f=e;h(a.callbacks.ajax.success,c,[b,a.parameter,j,l,f]);t()},error:function(e,j,l){f=e;n=j;q=l;h(a.callbacks.ajax.error,c,[b,a.parameter,f,n,q]);m&&m.test("++",1,[k,d.location.href],"ajax error");m&&m.end();if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):E(b)}}));if(!1===h(a.callbacks.after,c,[b,a.parameter]))return c}}
function h(c,b,d){if("function"===typeof c)return c.apply(b,d)}function B(c){var b=jQuery.Deferred();if(!c)return b.resolve();setTimeout(function(){b.resolve()},c);return b.promise()}function E(c){"click"===c.type.toLowerCase()?d.location.href=c.currentTarget.href:"submit"===c.type.toLowerCase()?context.submit():"popstate"===c.type.toLowerCase()&&d.location.reload()}function C(c,b){var d=[];c.replace(RegExp(b,"gim"),function(b,a){d.push(a)});return d}if("function"===typeof this)return arguments.callee.apply(jQuery(D),
arguments);var t="object"===typeof window.validator?window.validator:!1;(t=t?t.clone({name:"jquery.pjax.js",base:!0,timeout:{limit:u&&u.ajax&&u.ajax.timeout?u.ajax.timeout+t.timeout.limit:t.timeout.limit}}):t)&&t.start();t&&t.test(1,1,0,"plugin load");var n=jQuery.extend(!0,{},{id:0,gns:"pjax",ns:w,area:w,link:'a:not([target])[href^="/"]',form:w,scrollTop:0,scrollLeft:0,ajax:{},contentType:"text/html",cache:{click:!1,submit:!1,popstate:!1,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},
update:{url:{},title:{},content:{},css:{},script:{},cache:{load:{},save:{}}}},parameter:w,load:{css:!1,script:!1,sync:!0,async:0},interval:300,wait:0,fallback:!0,server:{query:""},speedcheck:!1},u),q=[n.gns].concat(n.ns||[]);jQuery.extend(!0,n,{nss:{pjax:q.join("."),click:["click"].concat(q.join(":")).join("."),submit:["submit"].concat(q.join(":")).join("."),popstate:["popstate"].concat(q.join(":")).join("."),data:q.join(":"),class4html:q.join("-"),requestHeader:["X",q[0].replace(/^\w/,function(c){return c.toUpperCase()})].join("-"),
array:q},server:{query:n.server.query.length?n.server.query:n.gns},log:{script:{},speed:{}},history:{order:[],data:{},size:0},timestamp:(new Date).getTime(),disable:!1,on:function(){for(var c=1,b=p.length;c<b;c++)p[c].disable=!1},off:function(){for(var c=1,b=p.length;c<b;c++)p[c].disable=!0},landing:d.location.href,validate:t,speed:{now:function(){return(new Date).getTime()}}});if(!("pushState"in d.history&&null!==d.history.pushState)?0:jQuery(n.area).length){var e=n;e.id=p.length;p.push(e);e.link&&
jQuery(this).undelegate(e.link,e.nss.click).delegate(e.link,e.nss.click,e.id,function(c){c.timeStamp=(new Date).getTime();if(1<c.which||(c.metaKey||c.ctrlKey||c.shiftKey||c.altKey)||(d.location.protocol!==this.protocol||d.location.host!==this.host)||d.location.pathname===this.pathname&&d.location.search===this.search&&d.location.hash!==this.hash)return this;var b,e,h;b=p[c.data];e=this.href;b.cache[c.type.toLowerCase()]&&(h=b.history.data[e]);h&&c.timeStamp>h.timestamp+b.cache.expire&&(h=w);b.landing&&
(b.landing=!1);if(b.disable)return c.preventDefault(),!1;b.off();x(this,c,e,e!==d.location.href,b,h);c.preventDefault();return!1});e.form&&jQuery(this).undelegate(e.form,e.nss.submit).delegate(e.form,e.nss.submit,e.id,function(c){c.timeStamp=(new Date).getTime();var b,d,e;b=p[c.data];d=jQuery(c.target).attr("action");b.cache[c.type.toLowerCase()]&&(e=b.history.data[d]);e&&c.timeStamp>e.timestamp+b.cache.expire&&(e=w);b.landing&&(b.landing=!1);if(b.disable)return c.preventDefault(),!1;b.off();x(this,
c,d,!0,b,e);c.preventDefault();return!1});jQuery(d).unbind(e.nss.popstate).bind(e.nss.popstate,e.id,function(c){c.timeStamp=(new Date).getTime();var b,e,h;b=p[c.data];e=d.location.href;b.cache[c.type.toLowerCase()]&&(h=b.history.data[e]);h&&c.timeStamp>h.timestamp+b.cache.expire&&(h=w);if(b.landing){if(b.landing===d.location.href){b.landing=!1;return}b.landing=!1}if(b.disable)return c.preventDefault(),!1;b.off();x(this,c,e,!1,b,h);c.preventDefault();return!1});jQuery("script[src]").each(function(){this.src in
e.log.script||(e.log.script[this.src]=!0)})}t&&t.end();return{on:n.on,off:n.off}}if("undefined"!==typeof window.jQuery){jQuery=window.jQuery;var w=void 0,d=window,D=document,p=["settings"];jQuery.fn.pjax=x;jQuery.pjax=x;x=null}})();
