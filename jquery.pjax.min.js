/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.11.10
 * @updated 2013/05/22
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor Closure Compiler
 */
(function(){function s(y){function s(k,b,g,f,j){function r(c){var d=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - update()"}):d;d&&d.start();d&&(d.scope=function(a){return eval(a)});d&&d.test("1",1,0,"update()");d&&d.test("++",1,0,"update:start");a:if(a.speedcheck&&a.log.speed.name.push("update_start"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),!1!==n(a.callbacks.update.before,k,[b,a.parameter,m,l,e])){var j,B,q;try{d&&d.test("++",1,0,"update:try");
d&&d.test("++",1,!c?[a.contentType,e.getResponseHeader("Content-Type")]:0,"update:content-type");if(!c&&!RegExp(a.contentType.replace(/\s*[,;]\s*(.|$)/g,function(a,k){return k?"|"+k:""}),"i").test(e.getResponseHeader("Content-Type")))throw Error();d&&d.test("++","String(!!cache)",0,"update:cache");c&&!1!==n(a.callbacks.update.cache.load.before,k,[b,a.parameter,c])&&(e=c.XMLHttpRequest,m=e.responseText,l=c.dataType,j=c.title,B=c.css,q=c.script,n(a.callbacks.update.cache.load.after,k,[b,a.parameter,
c]));d&&d.test("++",1,0,"update:initialize");var u=jQuery(m),s=0<u.filter("title").length,w=a.area.replace(/(\((.*?(\(.*?\).*?)?)*?\)|\S)(,|$)/g,function(a,k,b,e,d){return k+(d?"|":"")}).split(/\s*\|(?!=)\s*/),x=null===a.scrollLeft?jQuery(h).scrollLeft():parseInt(a.scrollLeft),z=null===a.scrollTop?jQuery(h).scrollTop():parseInt(a.scrollTop);j=j?j:s?u.filter("title").text():jQuery("<span/>").html(E(m,"<title>([^<]*)</title>").join()).text();if(!jQuery(a.area).length||!u.find(a.area).add(u.filter(a.area)).length)throw Error("cancel");
d&&d.test("++",1,g,"update:url");if(!1!==n(a.callbacks.update.url.before,k,[b,a.parameter,m,l,e])){g=g.replace(RegExp("[?&]"+a.server.query+"=[^&#]*"),"");f&&h.history.pushState(a.gns,h.opera||-1!==h.navigator.userAgent.toLowerCase().indexOf("opera")?j:F.title,g);switch(!0){case /Mobile(\/\w+)? Safari/i.test(h.navigator.userAgent):h.history.back(),h.history.forward()}n(a.callbacks.update.url.after,k,[b,a.parameter,m,l,e])}d&&d.test("++",1,j,"update:title");!1!==n(a.callbacks.update.title.before,k,
[b,a.parameter,m,l,e])&&(F.title=j,n(a.callbacks.update.title.after,k,[b,a.parameter,m,l,e]));d&&d.test("++",1,w,"update:content");if(!1!==n(a.callbacks.update.content.before,k,[b,a.parameter,m,l,e])){for(var A=0,C;C=w[A];A++)jQuery(C).html(u.find(C).add(u.filter(C)).children()),a.load.script&&a.load.sync&&jQuery(C).append(jQuery("<div/>",{"class":a.nss.class4html+"-loaded",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax"));
n(a.callbacks.update.content.after,k,[b,a.parameter,m,l,e])}d&&d.test("++",1,0,"update:css");a.load.css&&setTimeout(function(){I()},a.load.async||0);var I=function(){var d=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - load_css()"}):d;d&&d.start();d&&(d.scope=function(a){return eval(a)});if(!1!==n(a.callbacks.update.css.before,k,[b,a.parameter,m,l,e])){B=B?B:s?u.find('link[rel="stylesheet"], style').add(u.filter('link[rel="stylesheet"], style')):E(m,'(<link[^>]*?rel="stylesheet"[^>]*?>|<style[^>]*?>(.|[\n\r])*?</style>)');
v(a.history,g)&&(v(a.history,g).css=B);jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data,!0)});for(var c=0,h,j=jQuery('link[rel="stylesheet"]'),q=jQuery("style"),f;h=B[c];c++){f=!1;h=s?h:jQuery(h)[0];if("LINK"===h.tagName.toUpperCase()&&j.filter(function(){if(f||this.href!==h.href)return!1;f=!0;jQuery.data(this,a.nss.data)&&jQuery.data(this,a.nss.data,!1);return!0}).length)continue;if("STYLE"===h.tagName.toUpperCase()&&q.filter(function(){if(f||!jQuery.data(this,
a.nss.data)||this.innerHTML!==h.innerHTML)return!1;f=!0;jQuery.data(this,a.nss.data,!1);return!0}).length)continue;jQuery.data(jQuery("head").append(h).children(":last-child")[0],a.nss.data,!1);h=null}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data)}).remove();!1!==n(a.callbacks.update.css.after,k,[b,a.parameter,m,l,e])&&(a.speedcheck&&a.log.speed.name.push("css"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}d&&d.end()};d&&d.test("++",
1,0,"update:script");a.load.script&&setTimeout(function(){G("async")},a.load.async||0);var G=function(d){var c=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - load_script()"}):c;c&&c.start();c&&(c.scope=function(a){return eval(a)});if(!1!==n(a.callbacks.update.script.before,k,[b,a.parameter,m,l,e])){var h=[];q=q?q:s?u.find("script").add(u.filter("script")):E(m,"(?:[^'\"]|^s*)(<script[^>]*?>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");v(a.history,g)&&(v(a.history,g).script=q);
for(var j=0,f;f=q[j];j++)if(f=s?f:jQuery(f)[0],"sync"!==d||f.defer)if(!("async"===d&&f.defer)&&(f.childNodes.length||!(f.src in a.log.script)))f.src&&(a.log.script[f.src]=!0),jQuery.when?(f=f.src?jQuery.ajax(jQuery.extend(!0,{},a.ajax,{url:f.src,dataType:"script",async:!1,global:!1})):jQuery.Deferred().resolve(f),h.push(f)):jQuery("head").append(f),f=null;jQuery.when&&h.length&&jQuery.when.apply(null,h).done(function(){for(var a=0,k;k=arguments[a];a++)0<Number(k.nodeType)&&eval((k.text||k.textContent||
k.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,"/*$0*/"))});n(a.callbacks.update.script.after,k,[b,a.parameter,m,l,e])}c&&c.end()};a.load.script&&a.load.sync?setTimeout(function(){jQuery(a.area).length===jQuery(a.area).children("."+a.nss.class4html+"-loaded").filter(function(){return this.clientWidth}).length?(jQuery(a.area).children("."+a.nss.class4html+"-loaded").remove(),setTimeout(function(){G("sync")},0),a.speedcheck&&a.log.speed.name.push("script"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-
a.log.speed.fire),a.speedcheck&&console.log(a.log.speed.time),a.speedcheck&&console.log(a.log.speed.name)):setTimeout(function(){arguments.callee()},a.interval)},0):a.load.script&&setTimeout(function(){G("sync")},a.load.async||0);d&&d.test("++",1,0,"update:scroll");switch(b.type.toLowerCase()){case "click":h.scrollTo(x,z);break;case "submit":h.scrollTo(x,z);break;case "popstate":h.history.state instanceof Object&&isFinite(h.history.state.scrollY)&&(h.scrollTo(x,h.history.state.scrollY),h.history.state.scrollY=
t,h.history.replaceState(h.history.state,j,g))}d&&d.test("++",1,0,"update:cache");if((a.cache.click||a.cache.submit||a.cache.popstate)&&"POST"!==a.ajax.type&&!1!==n(a.callbacks.update.cache.save.before,k,[b,a.parameter,c]))v(a.history,g,j,y,m,l,e),n(a.callbacks.update.cache.save.after,k,[b,a.parameter,c]);if(!1===n(a.callbacks.update.success,k,[b,a.parameter,m,l,e]))break a;if(!1===n(a.callbacks.update.complete,k,[b,a.parameter,m,l,e]))break a;if(!1===n(a.callback,k,[b,a.parameter,m,l,e]))break a;
d&&d.test("++",1,0,"update: success")}catch(D){d&&(d.scope=function(a){return eval(a)});d&&d.test("++",'err.message === "cancel"',D,"update:catch");c&&v(a.history,g,j,null);if(!1===n(a.callbacks.update.error,k,[b,a.parameter,m,l,e]))break a;if(!1===n(a.callbacks.update.complete,k,[b,a.parameter,m,l,e]))break a;d&&d.test("++",1,[g,h.location.href],"update: error");if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):H(b,d)}!1!==n(a.callbacks.update.after,k,[b,a.parameter,m,l,e])&&(a.on(),
a.speedcheck&&a.log.speed.name.push("end"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),d&&d.test("++","url === win.location.href",[g,h.location.href],"update: is updated"),d&&d.test("++",1,0,"update:end"),d&&d.end())}}var c=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):c;c&&c.start();c&&(c.scope=function(a){return eval(a)});c&&c.test(1,1,[g,b.type],"drive()");c&&c.test(2,1,0,"drive:start");a.speedcheck&&(a.log.speed.fire=b.timeStamp);a.speedcheck&&
(a.log.speed.time=[]);a.speedcheck&&(a.log.speed.name=[]);a.speedcheck&&a.log.speed.name.push("fire");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);if(!1!==n(a.callbacks.before,k,[b,a.parameter]))if(j)c&&c.test(3,1,0,"drive:update"),jQuery.when?jQuery.when(D(a.wait)).done(function(){r(j)}):r(j),c&&c.test(4,1,0,"drive:end"),c&&c.end();else{c&&c.test(3,1,0,"drive:initialize");var m,l,e,q,w,y,x=[],z={xhr:function(){e=n(a.callbacks.ajax.xhr,k,[b,a.parameter]);e=e instanceof Object&&
e instanceof h.XMLHttpRequest?e:e||jQuery.ajaxSettings.xhr();e instanceof Object&&(e instanceof h.XMLHttpRequest&&"onprogress"in e)&&e.addEventListener("progress",function(a){y=a.loaded},!1);return e},dataFilter:function(e,d){m=e;l=d;return n(a.callbacks.ajax.dataFilter,k,[b,a.parameter,m,l])||m},complete:function(c,d){e=c;q=d;n(a.callbacks.ajax.complete,k,[b,a.parameter,e,q])}},A;for(A in z)A in a.callbacks.ajax||"xhr"===A||delete z[A];c&&c.test(4,1,0,"drive:popstate");if("popstate"===b.type.toLowerCase()){if((x=
g.match(/\?[^\s]*/))&&"?"!==x[0])a.ajax.type="GET";a.ajax.data=null}c&&c.test(5,1,0,"drive:submit");"submit"===b.type.toLowerCase()&&(g=g.replace(/\?[^\s]*/,""),a.ajax.type=jQuery(b.target).attr("method").toUpperCase(),"GET"===a.ajax.type&&(c&&c.test(5.1,1,jQuery(b.target).serialize(),"drive:serialize"),g+="?"+jQuery(b.target).serialize(),a.ajax.data=null),"POST"===a.ajax.type&&(c&&c.test(5.1,1,jQuery(b.target).serializeArray(),"drive:serializeArray"),a.ajax.data=jQuery(b.target).serializeArray()));
c&&c.test(6,1,0,"drive:url");a.server.query&&(g=g.replace(/(#[^\s]*|)$/,(!g.match(/\?/)?"?":"&")+encodeURIComponent(a.server.query)+"=1$1"));c&&c.test(7,1,0,"drive:ajax");a.speedcheck&&a.log.speed.name.push("ajax_start");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);jQuery.when?jQuery.when(D(a.wait),jQuery.ajax(jQuery.extend(!0,{},a.ajax,z,{url:g,beforeSend:function(c){e=c;e.setRequestHeader(a.nss.requestHeader,"true");e.setRequestHeader(a.nss.requestHeader+"-Area",a.area);e.setRequestHeader(a.nss.requestHeader+
"-CSS",a.load.css);e.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);n(a.callbacks.ajax.beforeSend,k,[b,a.parameter,e])},success:function(c,d,g){m=c;l=d;e=g;n(a.callbacks.ajax.success,k,[b,a.parameter,m,l,e])},error:function(c,d,f){e=c;q=d;w=f;var j=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):j;j&&j.start();j&&j.test("++",1,[g,h.location.href],"ajax_regular()");j&&j.test("++",1,[e,q,w],"ajax error");n(a.callbacks.ajax.error,k,[b,a.parameter,e,
q,w]);if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):H(b,j);j&&j.end()}}))).done(function(){r()}).fail().always():jQuery.ajax(jQuery.extend(!0,{},a.ajax,z,{url:g,beforeSend:function(c){e=c;e.setRequestHeader(a.nss.requestHeader,"true");e.setRequestHeader(a.nss.requestHeader+"-Area",a.area);e.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);e.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);n(a.callbacks.ajax.beforeSend,k,[b,a.parameter,e])},success:function(c,
d,g){m=c;l=d;e=g;n(a.callbacks.ajax.success,k,[b,a.parameter,m,l,e]);r()},error:function(c,d,j){e=c;q=d;w=j;var f=p[a.id]&&p[a.id].validate?p[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):f;f&&f.start();f&&f.test("++",1,[g,h.location.href],"ajax_legacy()");f&&f.test("++",1,[e,q,w],"ajax error");n(a.callbacks.ajax.error,k,[b,a.parameter,e,q,w]);if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):H(b,f);f&&f.end()}}));!1!==n(a.callbacks.after,k,[b,a.parameter])&&(c&&c.test(8,
1,0,"drive:end"),c&&c.end())}}function n(a,b,g){if("function"===typeof a)return a.apply(b,g)}function D(a){var b=jQuery.Deferred();if(!a)return b.resolve();setTimeout(function(){b.resolve()},a);return b.promise()}function H(a,b){b&&b.test("++",1,0,"fallback()");b&&b.end();"click"===a.type.toLowerCase()?h.location.href=a.currentTarget.href:"submit"===a.type.toLowerCase()?context.submit():"popstate"===a.type.toLowerCase()&&h.location.reload()}function E(a,b){var g=[];a.replace(RegExp(b,"gim"),function(a,
k){g.push(k)});return g}function v(a,b,g,f,h,j,c){var m;switch(!0){case a===t||b===t:break;case g===t:a.data[b]&&(new Date).getTime()>a.data[b].timestamp+a.config.expire&&arguments.callee(a,b,null,null);m=a.data[b];break;case null===f:for(var l=0,e;e=a.order[l];l++)b===e&&(a.order.splice(l,1),a.size-=a.data[e].size,a.data[e]=null,delete a.data[e]);break;default:a.order.unshift(b);for(l=1;e=a.order[l];l++)b===e&&a.order.splice(l,1);if(a.data[b])break;f=f||2*h.length;a.size=a.size||0;a.size+=f;a.data[b]=
{data:null,dataType:j,XMLHttpRequest:c,title:g,size:f,timestamp:(new Date).getTime()};for(l=a.order.length-1;b=a.order[l];l--)if(l>=a.config.length||a.size>a.config.size||(new Date).getTime()>a.data[b].timestamp+a.config.expire)a.order.splice(l,1),a.size=a.size||0,a.size-=a.data[b].size,a.data[b]=null,delete a.data[b]}return m}function x(a,b,g){var f;switch(!0){case b===t:f=jQuery.falsandtru[a];break;case g===t:f=a in jQuery.falsandtru?jQuery.falsandtru[a][b]:t;break;case g!==t:jQuery.falsandtru[a]instanceof
Object||(jQuery.falsandtru[a]={}),jQuery.falsandtru[a][b]instanceof Object&&g instanceof Object?jQuery.extend(!0,jQuery.falsandtru[a][b],g):jQuery.falsandtru[a][b]=g,f=jQuery.falsandtru[a][b]}return f}if("function"===typeof this)return arguments.callee.apply(jQuery(F),arguments);var r=window.validator instanceof Object?window.validator:!1;(r=r?r.clone({name:"jquery.pjax.js",base:!0,timeout:{limit:y&&y.ajax&&y.ajax.timeout?y.ajax.timeout+r.timeout.limit:r.timeout.limit}}):r)&&r.start();r&&r.test("++",
1,0,"pjax()");var a=jQuery.extend(!0,{},{id:0,gns:"pjax",ns:t,area:t,link:'a:not([target])[href^="/"]',form:t,scrollTop:0,scrollLeft:0,ajax:{},contentType:"text/html",cache:{click:!1,submit:!1,popstate:!1,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},content:{},css:{},script:{},cache:{load:{},save:{}}}},parameter:t,load:{css:!1,script:!1,sync:!0,async:0},interval:300,wait:0,fallback:!0,server:{query:""},speedcheck:!1},y),q=[a.gns].concat(a.ns||
[]);jQuery.extend(!0,a,{nss:{pjax:q.join("."),click:["click"].concat(q.join(":")).join("."),submit:["submit"].concat(q.join(":")).join("."),popstate:["popstate"].concat(q.join(":")).join("."),data:q.join(":"),class4html:q.join("-"),requestHeader:["X",q[0].replace(/^\w/,function(a){return a.toUpperCase()})].join("-"),array:q},server:{query:a.server.query.length?a.server.query:a.gns},log:{script:{},speed:{}},history:{config:a.cache,order:[],data:{}},timestamp:(new Date).getTime(),disable:!1,on:function(){for(var a=
1,b=p.length;a<b;a++)p[a].disable=!1},off:function(){for(var a=1,b=p.length;a<b;a++)p[a].disable=!0},landing:h.location.href,validate:r,speed:{now:function(){return(new Date).getTime()}}});jQuery.falsandtru||(jQuery.fn.falsandtru=x,jQuery.falsandtru=x);jQuery.falsandtru("share","history",a.history);a.history=jQuery.falsandtru("share","history");if(!("pushState"in h.history&&null!==h.history.pushState)?0:jQuery(a.area).length){var j=a;j.id=p.length;p.push(j);j.link&&jQuery(this).undelegate(j.link,
j.nss.click).delegate(j.link,j.nss.click,j.id,function(a){a.timeStamp=(new Date).getTime();if(1<a.which||(a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)||(h.location.protocol!==this.protocol||h.location.host!==this.host)||h.location.pathname===this.pathname&&h.location.search===this.search&&h.location.hash!==this.hash)return this;var b,g,f;b=p[a.data];g=this.href;b.cache[a.type.toLowerCase()]&&(f=v(b.history,g));b.landing&&(b.landing=!1);if(b.disable)return a.preventDefault(),!1;b.off();s(this,a,g,g!==
h.location.href,f);a.preventDefault();return!1});j.form&&jQuery(this).undelegate(j.form,j.nss.submit).delegate(j.form,j.nss.submit,j.id,function(a){a.timeStamp=(new Date).getTime();var b,g,f;b=p[a.data];g=this.action;b.cache[a.type.toLowerCase()]&&(f=v(b.history,g));b.landing&&(b.landing=!1);if(b.disable)return a.preventDefault(),!1;b.off();s(this,a,g,!0,f);a.preventDefault();return!1});jQuery(h).unbind(j.nss.popstate).bind(j.nss.popstate,j.id,function(a){a.timeStamp=(new Date).getTime();var b,g,
f;b=p[a.data];g=h.location.href;b.cache[a.type.toLowerCase()]&&(f=v(b.history,g));if(b.landing){if(b.landing===h.location.href){b.landing=!1;return}b.landing=!1}if(b.disable)return a.preventDefault(),!1;b.off();s(this,a,g,!1,f);a.preventDefault();return!1});jQuery("script[src]").each(function(){this.src in j.log.script||(j.log.script[this.src]=!0)})}r&&r.end();return{on:a.on,off:a.off}}if("undefined"!==typeof window.jQuery){jQuery=window.jQuery;var t=void 0,h=window,F=document,p=["settings"];jQuery.fn.pjax=
s;jQuery.pjax=s;s=null}})();
