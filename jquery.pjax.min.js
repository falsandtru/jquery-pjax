/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.6.1
 * @updated 2013/04/03
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @CodingConventions Google JavaScript Style Guide
 * @Compressor YUI Compressor
 */
(function(b){jQuery.fn.pjax=a;jQuery.pjax=a;a=null;function a(m){if(typeof this==="function"){return arguments.callee.apply(jQuery(document),arguments)}var g={gns:"pjax",ns:undefined,area:undefined,link:'a:not([target])[href^="/"]',form:undefined,scrollTop:0,scrollLeft:0,ajax:{},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},content:{},css:{},script:{}}},parameter:undefined,load:{css:false,script:false,async:{css:null,script:null}},wait:0,fallback:true},f=jQuery.extend(true,{},g,m);jQuery.extend(true,f,{nss:{click:["click",f.gns+(f.ns===undefined?"":":"+f.ns)].join("."),submit:["submit",f.gns+(f.ns===undefined?"":":"+f.ns)].join("."),popstate:["popstate",f.gns+(f.ns===undefined?"":":"+f.ns)].join("."),data:f.gns+(f.ns===undefined?"":"."+f.ns),requestHeader:["X",f.gns.replace(/^(\w)/,function(n){return n.toUpperCase()})].join("-")}});if(!d()){return this}k(this,f);function d(){if(!l()){return false}if(!jQuery(f.area).length){return false}return true}function l(){return"pushState" in window.history&&window.history.pushState!==null}function k(n,o){DELEGATE_CLICK:{if(o.link===undefined){break DELEGATE_CLICK}if(o.form!==undefined){break DELEGATE_CLICK}jQuery(n).undelegate(o.link,o.nss.click).delegate(o.link,o.nss.click,o,function(p){if(p.which>1||p.metaKey||p.ctrlKey||p.shiftKey||p.altKey){return this}if(location.protocol!==this.protocol||location.host!==this.host){return this}if(location.pathname===this.pathname&&location.search===this.search&&location.hash!==this.hash){return this}j(this,p,this.href,location.href!==this.href,p.data)})}DELEGATE_SUBMIT:{if(o.form===undefined){break DELEGATE_SUBMIT}jQuery(n).undelegate(o.form,o.nss.submit).delegate(o.form,o.nss.submit,o,function(p){j(this,p,jQuery(p.target).attr("action"),true,p.data)})}BIND_POPSTATE:{setTimeout(function(){jQuery(window).unbind(o.nss.popstate).bind(o.nss.popstate,o,function(p){j(this,p,location.href,false,p.data)})},100)}}function j(p,n,o,C,r){var u,z,B,q,v,y,x=[],s=[],w={dataFilter:function(F,E){u=F;z=E;return e(r.callbacks.ajax.dataFilter,p,[n,r.parameter,u,z])},complete:function(F,E){B=F;q=E;e(r.callbacks.ajax.complete,p,[n,r.parameter,B,q])}};for(var t in w){if(t in r.callbacks.ajax){continue}delete w[t]}POPSTATE:{if(n.type.toLowerCase()!=="popstate"){break POPSTATE}GET:{x=o.match(/\?[^\s]*/);if(x===null||x[0]==="?"){break GET}r.ajax.type="GET"}delete r.ajax.data}SUBMIT:{if(n.type.toLowerCase()!=="submit"){break SUBMIT}o=o.replace(/\?[^\s]*/,"");r.ajax.type=jQuery(n.target).attr("method").toUpperCase();GET:{if(r.ajax.type!=="GET"){break GET}o+="?"+jQuery(n.target).serialize();delete r.ajax.data}POST:{if(r.ajax.type!=="POST"){break POST}r.ajax.data=jQuery(n.target).serializeArray()}}if(e(r.callbacks.before,p,[n,r.parameter])===false){return p}switch(jQuery().jquery){case"1.0":case"1.0.4":case"1.1.0":case"1.1.2":case"1.1.3":case"1.1.4":case"1.2":case"1.2.3":case"1.2.6":case"1.3":case"1.4":case"1.4.1":case"1.4.2":case"1.4.3":case"1.4.4":D();break;case"1.5":case"1.5.1":case"1.5.2":case"1.6":case"1.6.1":case"1.6.2":case"1.6.3":case"1.6.4":case"1.7":case"1.7.1":case"1.7.2":case"1.8":case"1.8.1":case"1.8.2":case"1.8.3":case"1.9":case"1.9.1":default:A();break}if(e(r.callbacks.after,p,[n,r.parameter])===false){return p}n.preventDefault();function A(){jQuery.when(h(r.wait),jQuery.ajax(jQuery.extend(true,{},r.ajax,w,{url:o,beforeSend:function(E){B=E;B.setRequestHeader(r.nss.requestHeader,"true");B.setRequestHeader(r.nss.requestHeader+"-Area",r.area);B.setRequestHeader(r.nss.requestHeader+"-CSS",r.load.css);B.setRequestHeader(r.nss.requestHeader+"-Script",r.load.script);e(r.callbacks.ajax.beforeSend,p,[n,r.parameter,B])},success:function(G,F,E){u=G;z=F;B=E;e(r.callbacks.ajax.success,p,[n,r.parameter,u,z,B])},error:function(G,F,E){B=G;q=F;v=E;e(r.callbacks.ajax.error,p,[n,r.parameter,B,q,v]);r.fallback?i(p,true):null}}))).done(function(){UPDATE:{if(e(r.callbacks.update.before,p,[n,r.parameter,u,z,B])===false){break UPDATE}try{if(B.getResponseHeader("Content-Type").indexOf("text/html")===-1){throw new Error()}var O=jQuery(u).filter("title").text(),L=c(u,'<link[^>]*?rel="stylesheet"[^>]*?>|<style[^>]*?>(.|[\n\r])*?</style>'),N=c(u,"<script[^>]*?>(.|[\n\r])*?<\/script>"),E=r.area.split(","),Q=r.scrollLeft===null?jQuery(window).scrollLeft():parseInt(r.scrollLeft),P=r.scrollTop===null?jQuery(window).scrollTop():parseInt(r.scrollTop),I=jQuery(r.area).length,H=jQuery(r.area,u).add(jQuery(u).filter(r.area)).length;if(I===0||I!==H){throw new Error()}UPDATE_URL:{if(e(r.callbacks.update.url.before,p,[n,r.parameter,u,z,B])===false){break UPDATE_URL}C?history.pushState(null,window.opera||("userAgent" in window&&userAgent.indexOf("opera")!==-1)?O:document.title,o):null;if(e(r.callbacks.update.url.after,p,[n,r.parameter,u,z,B])===false){break UPDATE_URL}}UPDATE_TITLE:{if(e(r.callbacks.update.title.before,p,[n,r.parameter,u,z,B])===false){break UPDATE_TITLE}document.title=O;if(e(r.callbacks.update.title.after,p,[n,r.parameter,u,z,B])===false){break UPDATE_TITLE}}UPDATE_CONTENT:{if(e(r.callbacks.update.content.before,p,[n,r.parameter,u,z,B])===false){break UPDATE_CONTENT}for(var J=0,F;F=E[J];J++){jQuery(F).html(jQuery(F,u).add(jQuery(u).filter(F)).html())}if(e(r.callbacks.update.content.after,p,[n,r.parameter,u,z,B])===false){break UPDATE_CONTENT}}r.load.async.css===null?K():setTimeout(function(){K()},r.load.async.css);function K(){UPDATE_CSS:{if(!r.load.css){break UPDATE_CSS}if(e(r.callbacks.update.css.before,p,[n,r.parameter,u,z,B])===false){break UPDATE_CSS}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,r.nss.data,true)});for(var S=0,R;R=L[S];S++){R=jQuery(R)[0];LINK:{if(R.tagName.toUpperCase()!=="LINK"){break LINK}if(jQuery('link[rel="stylesheet"]').filter(function(){if(this.href===R.href){jQuery.data(this,r.nss.data)?jQuery.data(this,r.nss.data,false):null;return true}return false}).length){continue}}STYLE:{if(R.tagName.toUpperCase()!=="STYLE"){break STYLE}if(jQuery("style").filter(function(){if(this.innerHTML===R.innerHTML){jQuery.data(this,r.nss.data)?jQuery.data(this,r.nss.data,false):null;return true}return false}).length){continue}}jQuery.data(jQuery("head").append(R).children(":last-child").get(0),r.nss.data,false)}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,r.nss.data)}).remove();if(e(r.callbacks.update.css.after,p,[n,r.parameter,u,z,B])===false){break UPDATE_CSS}}}r.load.async.script===null?M():setTimeout(function(){M()},r.load.async.script);function M(){UPDATE_SCRIPT:{if(!r.load.script){break UPDATE_SCRIPT}if(e(r.callbacks.update.script.before,p,[n,r.parameter,u,z,B])===false){break UPDATE_SCRIPT}for(var S=0,R;R=N[S];S++){R=jQuery(R)[0];if(jQuery("script[src]").filter(function(){if(this.src===R.src){return true}return false}).length){continue}jQuery.data(jQuery("head").append(R).children(":last-child").get(0),r.nss.data,false)}if(e(r.callbacks.update.script.after,p,[n,r.parameter,u,z,B])===false){break UPDATE_SCRIPT}}}C&&n.type.toLowerCase()==="click"?window.scrollTo(Q,P):null;if(e(r.callbacks.update.success,p,[n,r.parameter,u,z,B])===false){break UPDATE}if(e(r.callbacks.update.complete,p,[n,r.parameter,u,z,B])===false){break UPDATE}if(e(r.callback,p,[n,r.parameter,u,z,B])===false){break UPDATE}}catch(G){if(e(r.callbacks.update.error,p,[n,r.parameter,u,z,B])===false){break UPDATE}if(e(r.callbacks.update.complete,p,[n,r.parameter,u,z,B])===false){break UPDATE}r.fallback?i(p,false):null}if(e(r.callbacks.update.after,p,[n,r.parameter,u,z,B])===false){break UPDATE}}}).fail().always()}function D(){jQuery.ajax(jQuery.extend(true,{},r.ajax,w,{url:o,beforeSend:function(E){B=E;B.setRequestHeader(r.nss.requestHeader,"true");B.setRequestHeader(r.nss.requestHeader+"-Area",r.area);B.setRequestHeader(r.nss.requestHeader+"-CSS",r.load.css);B.setRequestHeader(r.nss.requestHeader+"-Script",r.load.script);e(r.callbacks.ajax.beforeSend,p,[n,r.parameter,B])},success:function(O,L,K){u=O;z=L;B=K;e(r.callbacks.ajax.success,p,[n,r.parameter,u,z,B]);UPDATE:{if(e(r.callbacks.update.before,p,[n,r.parameter,u,z,B])===false){break UPDATE}try{if(B.getResponseHeader("Content-Type").indexOf("text/html")===-1){throw new Error()}var R=jQuery(u).filter("title").text(),N=c(u,'<link[^>]*?rel="stylesheet"[^>]*?>|<style[^>]*?>(.|[\n\r])*?</style>'),Q=c(u,"<script[^>]*?>(.|[\n\r])*?<\/script>"),E=r.area.split(","),T=r.scrollLeft===null?jQuery(window).scrollLeft():parseInt(r.scrollLeft),S=r.scrollTop===null?jQuery(window).scrollTop():parseInt(r.scrollTop),I=jQuery(r.area).length,H=jQuery(r.area,u).add(jQuery(u).filter(r.area)).length;if(I===0||I!==H){throw new Error()}UPDATE_URL:{if(e(r.callbacks.update.url.before,p,[n,r.parameter,u,z,B])===false){break UPDATE_URL}C?history.pushState(null,window.opera||("userAgent" in window&&userAgent.indexOf("opera")!==-1)?R:document.title,o):null;if(e(r.callbacks.update.url.after,p,[n,r.parameter,u,z,B])===false){break UPDATE_URL}}UPDATE_TITLE:{if(e(r.callbacks.update.title.before,p,[n,r.parameter,u,z,B])===false){break UPDATE_TITLE}document.title=R;if(e(r.callbacks.update.title.after,p,[n,r.parameter,u,z,B])===false){break UPDATE_TITLE}}UPDATE_CONTENT:{if(e(r.callbacks.update.content.before,p,[n,r.parameter,u,z,B])===false){break UPDATE_CONTENT}for(var J=0,F;F=E[J];J++){jQuery(F).html(jQuery(F,u).add(jQuery(u).filter(F)).html())}if(e(r.callbacks.update.content.after,p,[n,r.parameter,u,z,B])===false){break UPDATE_CONTENT}}r.load.async.css===null?M():setTimeout(function(){M()},r.load.async.css);function M(){UPDATE_CSS:{if(!r.load.css){break UPDATE_CSS}if(e(r.callbacks.update.css.before,p,[n,r.parameter,u,z,B])===false){break UPDATE_CSS}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,r.nss.data,true)});for(var V=0,U;U=N[V];V++){U=jQuery(U)[0];LINK:{if(U.tagName.toUpperCase()!=="LINK"){break LINK}if(jQuery('link[rel="stylesheet"]').filter(function(){if(this.href===U.href){jQuery.data(this,r.nss.data)?jQuery.data(this,r.nss.data,false):null;return true}return false}).length){continue}}STYLE:{if(U.tagName.toUpperCase()!=="STYLE"){break STYLE}if(jQuery("style").filter(function(){if(this.innerHTML===U.innerHTML){jQuery.data(this,r.nss.data)?jQuery.data(this,r.nss.data,false):null;return true}return false}).length){continue}}jQuery.data(jQuery("head").append(U).children(":last-child").get(0),r.nss.data,false)}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,r.nss.data)}).remove();if(e(r.callbacks.update.css.after,p,[n,r.parameter,u,z,B])===false){break UPDATE_CSS}}}r.load.async.script===null?P():setTimeout(function(){P()},r.load.async.script);function P(){UPDATE_SCRIPT:{if(!r.load.script){break UPDATE_SCRIPT}if(e(r.callbacks.update.script.before,p,[n,r.parameter,u,z,B])===false){break UPDATE_SCRIPT}for(var V=0,U;U=Q[V];V++){U=jQuery(U)[0];if(jQuery("script[src]").filter(function(){if(this.src===U.src){return true}return false}).length){continue}jQuery.data(jQuery("head").append(U).children(":last-child").get(0),r.nss.data,false)}if(e(r.callbacks.update.script.after,p,[n,r.parameter,u,z,B])===false){break UPDATE_SCRIPT}}}C&&n.type.toLowerCase()==="click"?window.scrollTo(T,S):null;if(e(r.callbacks.update.success,p,[n,r.parameter,u,z,B])===false){break UPDATE}if(e(r.callbacks.update.complete,p,[n,r.parameter,u,z,B])===false){break UPDATE}if(e(r.callback,p,[n,r.parameter,u,z,B])===false){break UPDATE}}catch(G){if(e(r.callbacks.update.error,p,[n,r.parameter,u,z,B])===false){break UPDATE}if(e(r.callbacks.update.complete,p,[n,r.parameter,u,z,B])===false){break UPDATE}r.fallback?i(p,false):null}if(e(r.callbacks.update.after,p,[n,r.parameter,u,z,B])===false){break UPDATE}}},error:function(G,F,E){B=G;q=F;v=E;e(r.callbacks.ajax.error,p,[n,r.parameter,B,q,v]);r.fallback?i(p,true):null}}))}}function e(p,o,n){if(typeof p==="function"){return p.apply(o,n)}}function h(o){if(!o){return}var n=jQuery.Deferred();setTimeout(function(){n.resolve()},o);return n.promise()}function i(n,o){if(n.href!==undefined){location=n.href}else{if(o){location.reload()}}}function c(q,p){var o,n;o=new RegExp(p,"gim");n=q.match(o);return n}return this}})(jQuery);
