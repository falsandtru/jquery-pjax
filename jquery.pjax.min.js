/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.8.2
 * @updated 2013/04/18
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor Closure Compiler
 */
(function(){function p(p){function s(c,d,h,j,a,b){function t(r){a:if(a.speedcheck?a.log.speed.name.push("update_start"):null,a.speedcheck?a.log.speed.time.push(a.speed.now()-a.log.speed.fire):null,!1!==f(a.callbacks.update.before,c,[d,a.parameter,k,l,g])){try{if(!r&&-1===g.getResponseHeader("Content-Type").indexOf("text/html"))throw Error();var b,x,p;r&&!1!==f(a.callbacks.update.cache.load.before,c,[d,a.parameter,r])&&(g=r.XMLHttpRequest,k=g.responseText,l=r.dataType,b=r.title,x=r.css,p=r.script,
f(a.callbacks.update.cache.load.after,c,[d,a.parameter,r]));var v=jQuery(k),s=0<v.filter("title").length;b=b?b:s?v.filter("title").text():D(k,"<title>([^<]*)</title>");var w=a.area.split(","),y=null===a.scrollLeft?jQuery(m).scrollLeft():parseInt(a.scrollLeft),C=null===a.scrollTop?jQuery(m).scrollTop():parseInt(a.scrollTop);if(!jQuery(a.area).length||!v.find(a.area).add(v.filter(a.area)).length)throw Error();!1!==f(a.callbacks.update.url.before,c,[d,a.parameter,k,l,g])&&(h=h.replace(RegExp("[?&]"+
a.server.query+"=.*?([sW#&]|$)"),""),j?m.history.pushState(null,m.opera||"userAgent"in m&&-1!==userAgent.indexOf("opera")?b:E.title,h):null,f(a.callbacks.update.url.after,c,[d,a.parameter,k,l,g]));!1!==f(a.callbacks.update.title.before,c,[d,a.parameter,k,l,g])&&(E.title=b,f(a.callbacks.update.title.after,c,[d,a.parameter,k,l,g]));if(!1!==f(a.callbacks.update.content.before,c,[d,a.parameter,k,l,g])){for(var n=0,z;z=w[n];n++)jQuery(z).html(v.find(z).add(v.filter(z)).html()),a.load.script&&a.load.sync?
jQuery(z).append(jQuery("<div/>",{"class":a.nss.class4html+"-loaded",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax")):null;f(a.callbacks.update.content.after,c,[d,a.parameter,k,l,g])}a.load.css?setTimeout(function(){if(!1!==
f(a.callbacks.update.css.before,c,[d,a.parameter,k,l,g])){x=x?x:s?v.find('link[rel="stylesheet"], style').add(v.filter('link[rel="stylesheet"], style')):D(k,'(<link[^>]*?rel="stylesheet"[^>]*?>|<style[^>]*?>(.|[\n\r])*?</style>)');jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data,!0)});for(var h=0,e,b;e=x[h];h++){b=!1;e=s?e:jQuery(e)[0];if("LINK"===e.tagName.toUpperCase()&&jQuery('link[rel="stylesheet"]').filter(function(){if(b||this.href!==e.href)return!1;
b=!0;jQuery.data(this,a.nss.data)?jQuery.data(this,a.nss.data,!1):null;return!0}).length)continue;if("STYLE"===e.tagName.toUpperCase()&&jQuery("style").filter(function(){if(b||!jQuery.data(this,a.nss.data)||this.innerHTML!==e.innerHTML)return!1;b=!0;jQuery.data(this,a.nss.data,!1);return!0}).length)continue;jQuery.data(jQuery("head").append(e).children(":last-child")[0],a.nss.data,!1);e=null}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data)}).remove();!1!==
f(a.callbacks.update.css.after,c,[d,a.parameter,k,l,g])&&(a.speedcheck?a.log.speed.name.push("css"):null,a.speedcheck?a.log.speed.time.push(a.speed.now()-a.log.speed.fire):null)}},a.load.async||0):null;a.load.script?setTimeout(function(){B("async")},a.load.async||0):null;var B=function(e){if(!1!==f(a.callbacks.update.script.before,c,[d,a.parameter,k,l,g])){p=p?p:s?v.find("script").add(v.filter("script")):D(k,"(?:[^'\"]|^s*)(<script[^>]*?>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");for(var h=0,b;b=p[h];h++)if(b=
s?b:jQuery(b)[0],!a.load.sync||"sync"!==e||b.defer)if(!a.load.sync||!("async"===e&&b.defer))if(b.childNodes.length||!(b.src in a.log.script))b.src.length&&(a.log.script[b.src]=!0),jQuery.data(jQuery("head").append(b).children(":last-child")[0],a.nss.data,!1);f(a.callbacks.update.script.after,c,[d,a.parameter,k,l,g])}};a.load.script&&a.load.sync&&setTimeout(function(){jQuery(a.area).length===jQuery(a.area).children("."+a.nss.class4html+"-loaded").filter(function(){return this.clientWidth}).length?
(jQuery(a.area).children("."+a.nss.class4html+"-loaded").remove(),setTimeout(function(){B("sync")},0),a.speedcheck?a.log.speed.name.push("script"):null,a.speedcheck?a.log.speed.time.push(a.speed.now()-a.log.speed.fire):null,a.speedcheck?console.log(a.log.speed.time):null,a.speedcheck?console.log(a.log.speed.name):null):setTimeout(function(){arguments.callee()},a.interval)},0);j&&-1<"click,submit".indexOf(d.type.toLowerCase())?m.scrollTo(y,C):null;if((a.cache.click||a.cache.submit||a.cache.popstate)&&
"POST"!==a.ajax.type&&!1!==f(a.callbacks.update.cache.save.before,c,[d,a.parameter,r])){var e=a.history,A;e.order.unshift(h);for(var n=1,q;q=e.order[n];n++)h===q&&e.order.splice(n,1);if(!r){A=2*k.length;e.size+=A;e.data[h]={data:null,dataType:l,XMLHttpRequest:g,title:b,css:x,script:p,size:A,timestamp:(new Date).getTime()};n=e.order.length-1;for(A=e.size;q=e.order[n];n--)if(n>=a.cache.length||e.size>a.cache.size||d.timeStamp>e.data[q].timestamp+a.cache.expire)e.order.pop(),e.size-=e.data[q].size,e.data[q]=
null,delete e.data[q];a.history=e;f(a.callbacks.update.cache.save.after,c,[d,a.parameter,r])}}u[a.id]=a;if(!1===f(a.callbacks.update.success,c,[d,a.parameter,k,l,g]))break a;if(!1===f(a.callbacks.update.complete,c,[d,a.parameter,k,l,g]))break a;if(!1===f(a.callback,c,[d,a.parameter,k,l,g]))break a}catch(G){if(r){e=a.history;e.order.unshift(h);for(n=1;q=e.order[n];n++)h===q&&e.order.splice(n,1);n=e.order.length-1;for(A=e.size;q=e.order[n];n--)if(n>=a.cache.length||e.size>a.cache.size||d.timeStamp>
e.data[q].timestamp+a.cache.expire)e.order.pop(),e.size-=e.data[q].size,e.data[q]=null,delete e.data[q];a.history=e}u[a.id]=a;if(!1===f(a.callbacks.update.error,c,[d,a.parameter,k,l,g]))break a;if(!1===f(a.callbacks.update.complete,c,[d,a.parameter,k,l,g]))break a;a.fallback?F(d):null}!1!==f(a.callbacks.update.after,c,[d,a.parameter,k,l,g])&&(a.speedcheck?a.log.speed.name.push("end"):null,a.speedcheck?a.log.speed.time.push(a.speed.now()-a.log.speed.fire):null)}}a.speedcheck?a.log.speed.fire=d.timeStamp:
null;a.speedcheck?a.log.speed.time=[]:null;a.speedcheck?a.log.speed.name=[]:null;a.speedcheck?a.log.speed.name.push("fire"):null;a.speedcheck?a.log.speed.time.push(a.speed.now()-a.log.speed.fire):null;if(!1===f(a.callbacks.before,c,[d,a.parameter]))return c;if(b)jQuery.when?jQuery.when(B(a.wait)).done(function(){t(b)}):t(b);else{var k,l,g,w,p,s=[],y={dataFilter:function(b,g){k=b;l=g;return f(a.callbacks.ajax.dataFilter,c,[d,a.parameter,k,l])},complete:function(b,h){g=b;w=h;f(a.callbacks.ajax.complete,
c,[d,a.parameter,g,w])}},C;for(C in y)C in a.callbacks.ajax||delete y[C];if("popstate"===d.type.toLowerCase()){if((s=h.match(/\?[^\s]*/))&&"?"!==s[0])a.ajax.type="GET";a.ajax.data=null}"submit"===d.type.toLowerCase()&&(h=h.replace(/\?[^\s]*/,""),a.ajax.type=jQuery(d.target).attr("method").toUpperCase(),"GET"===a.ajax.type&&(h+="?"+jQuery(d.target).serialize(),a.ajax.data=null),"POST"===a.ajax.type&&(a.ajax.data=jQuery(d.target).serializeArray()));a.server.query&&(h=h.replace(/(#[^\s]*|)$/,(!h.match(/\?/)?
"?":"&")+encodeURIComponent(a.server.query)+"=1$1"));a.speedcheck?a.log.speed.name.push("ajax_start"):null;a.speedcheck?a.log.speed.time.push(a.speed.now()-a.log.speed.fire):null;jQuery.when?jQuery.when(B(a.wait),jQuery.ajax(jQuery.extend(!0,{},a.ajax,y,{url:h,beforeSend:function(b){g=b;g.setRequestHeader(a.nss.requestHeader,"true");g.setRequestHeader(a.nss.requestHeader+"-Area",a.area);g.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);g.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);
f(a.callbacks.ajax.beforeSend,c,[d,a.parameter,g])},success:function(b,h,j){k=b;l=h;g=j;f(a.callbacks.ajax.success,c,[d,a.parameter,k,l,g])},error:function(b,h,k){g=b;w=h;p=k;f(a.callbacks.ajax.error,c,[d,a.parameter,g,w,p]);a.fallback?F(d):null}}))).done(function(){t()}).fail().always():jQuery.ajax(jQuery.extend(!0,{},a.ajax,y,{url:h,beforeSend:function(b){g=b;g.setRequestHeader(a.nss.requestHeader,"true");g.setRequestHeader(a.nss.requestHeader+"-Area",a.area);g.setRequestHeader(a.nss.requestHeader+
"-CSS",a.load.css);g.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);f(a.callbacks.ajax.beforeSend,c,[d,a.parameter,g])},success:function(b,h,j){k=b;l=h;g=j;f(a.callbacks.ajax.success,c,[d,a.parameter,k,l,g]);t()},error:function(b,h,k){g=b;w=h;p=k;f(a.callbacks.ajax.error,c,[d,a.parameter,g,w,p]);a.fallback?F(d):null}}));if(!1===f(a.callbacks.after,c,[d,a.parameter]))return c}}function f(c,d,b){if("function"===typeof c)return c.apply(d,b)}function B(c){var d=jQuery.Deferred();if(!c)return d.resolve();
setTimeout(function(){d.resolve()},c);return d.promise()}function F(c){"click"===c.type.toLowerCase()?m.location.href=c.currentTarget.href:"submit"===c.type.toLowerCase()?context.submit():"popstate"===c.type.toLowerCase()&&m.location.reload()}function D(c,d){var b=[];c.replace(RegExp(d,"gim"),function(c,a){b.push(a)});return b}if("function"===typeof this)return arguments.callee.apply(jQuery(E),arguments);var j=jQuery.extend(!0,{},{id:0,gns:"pjax",ns:t,area:t,link:'a:not([target])[href^="/"]',form:t,
scrollTop:0,scrollLeft:0,ajax:{},cache:{click:!1,submit:!1,popstate:!1,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},content:{},css:{},script:{},cache:{load:{},save:{}}}},parameter:t,load:{css:!1,script:!1,sync:!0,async:0},interval:300,wait:0,fallback:!0,delay:500,server:{query:""},speedcheck:!1},p);jQuery.extend(!0,j,{nss:{class4html:""+(j.gns+(j.ns?"-"+j.ns:"")),click:["click",j.gns+(j.ns?":"+j.ns:"")].join("."),submit:["submit",j.gns+(j.ns?
":"+j.ns:"")].join("."),popstate:["popstate",j.gns+(j.ns?":"+j.ns:"")].join("."),data:j.gns+(j.ns?":"+j.ns:""),requestHeader:["X",j.gns.replace(/^\w/,function(c){return c.toUpperCase()})].join("-")},server:{query:j.server.query.length?j.server.query.length:j.gns},log:{script:{},speed:{}},history:{order:[],data:{},size:0},timestamp:(new Date).getTime(),speed:{now:function(){return(new Date).getTime()}}});if(!(!("pushState"in m.history&&null!==m.history.pushState)?0:jQuery(j.area).length))return this;
var b=j;b.id=u.length;u.push(b);b.link&&(b.form||jQuery(this).undelegate(b.link,b.nss.click).delegate(b.link,b.nss.click,b.id,function(c){c.timeStamp=(new Date).getTime();if(1<c.which||(c.metaKey||c.ctrlKey||c.shiftKey||c.altKey)||(m.location.protocol!==this.protocol||m.location.host!==this.host)||m.location.pathname===this.pathname&&m.location.search===this.search&&m.location.hash!==this.hash)return this;var d,b,f;d=u[c.data];b=this.href;d.cache[c.type.toLowerCase()]&&(f=d.history.data[b]);f&&c.timeStamp>
f.timestamp+d.cache.expire&&(f=t);s(this,c,b,b!==m.location.href,u[c.data],f);c.preventDefault()}));b.form&&jQuery(this).undelegate(b.form,b.nss.submit).delegate(b.form,b.nss.submit,b.id,function(c){c.timeStamp=(new Date).getTime();var b,h,f;b=u[c.data];h=jQuery(c.target).attr("action");b.cache[c.type.toLowerCase()]&&(f=b.history.data[h]);f&&c.timeStamp>f.timestamp+b.cache.expire&&(f=t);s(this,c,h,!0,u[c.data],f);c.preventDefault()});jQuery(m).unbind(b.nss.popstate).bind(b.nss.popstate,b.id,function(b){b.timeStamp=
(new Date).getTime();var d,f,j;d=u[b.data];f=m.location.href;d.cache[b.type.toLowerCase()]&&(j=d.history.data[f]);j&&b.timeStamp>j.timestamp+d.cache.expire&&(j=t);!1!==d.timestamp&&d.delay>b.timeStamp-d.timestamp?(d.timestamp=!1,u[d.id]=d):(s(this,b,f,!1,u[b.data],j),b.preventDefault())});jQuery("script[src]").each(function(){this.src in b.log.script||(b.log.script[this.src]=!0)});return this}if("undefined"!==typeof window.jQuery){jQuery=window.jQuery;var t=void 0,m=window,E=document,u=["settings"];
jQuery.fn.pjax=p;jQuery.pjax=p;p=null}})();
