/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.11.1
 * @updated 2013/05/10
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor Closure Compiler
 */
(function(){function v(t){function v(b,c,n,e,a,d){function r(s){l&&l.test("++",1,0,"update()");l&&(l.scope=function(a){return eval(a)});a:if(a.speedcheck&&a.log.speed.name.push("update_start"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),!1!==k(a.callbacks.update.before,b,[c,a.parameter,g,h,f])){var d,m,p;try{if(!s&&!RegExp(a.contentType.replace(/[,;\s]*(.|$)/g,function(a,b){return b?"|"+b:""}),"i").test(f.getResponseHeader("Content-Type")))throw Error();s&&!1!==k(a.callbacks.update.cache.load.before,
b,[c,a.parameter,s])&&(f=s.XMLHttpRequest,g=f.responseText,h=s.dataType,d=s.title,m=s.css,p=s.script,k(a.callbacks.update.cache.load.after,b,[c,a.parameter,s]));var q=jQuery(g),t=0<q.filter("title").length,v=a.area.split(","),x=null===a.scrollLeft?jQuery(j).scrollLeft():parseInt(a.scrollLeft),y=null===a.scrollTop?jQuery(j).scrollTop():parseInt(a.scrollTop);d=d?d:t?q.filter("title").text():jQuery("<span/>").html(B(g,"<title>([^<]*)</title>").join()).text();if(!jQuery(a.area).length||!q.find(a.area).add(q.filter(a.area)).length)throw Error();
if(!1!==k(a.callbacks.update.url.before,b,[c,a.parameter,g,h,f])){n=n.replace(RegExp("[?&]"+a.server.query+"=[^&#]*"),"");e&&j.history.pushState(a.gns,j.opera||-1!==j.navigator.userAgent.toLowerCase().indexOf("opera")?d:C.title,n);switch(!0){case /Mobile(\/\w+)? Safari/i.test(j.navigator.userAgent):j.history.back(),j.history.forward()}k(a.callbacks.update.url.after,b,[c,a.parameter,g,h,f])}!1!==k(a.callbacks.update.title.before,b,[c,a.parameter,g,h,f])&&(C.title=d,k(a.callbacks.update.title.after,
b,[c,a.parameter,g,h,f]));if(!1!==k(a.callbacks.update.content.before,b,[c,a.parameter,g,h,f])){for(var A=0,z;z=v[A];A++)jQuery(z).html(q.find(z).add(q.filter(z)).children()),a.load.script&&a.load.sync&&jQuery(z).append(jQuery("<div/>",{"class":a.nss.class4html+"-loaded",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax"));
k(a.callbacks.update.content.after,b,[c,a.parameter,g,h,f])}a.load.css&&setTimeout(function(){if(!1!==k(a.callbacks.update.css.before,b,[c,a.parameter,g,h,f])){m=m?m:t?q.find('link[rel="stylesheet"], style').add(q.filter('link[rel="stylesheet"], style')):B(g,'(<link[^>]*?rel="stylesheet"[^>]*?>|<style[^>]*?>(.|[\n\r])*?</style>)');w(a.history,n).css=m;jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data,!0)});for(var s=0,d,e=jQuery('link[rel="stylesheet"]'),
l=jQuery("style"),j;d=m[s];s++){j=!1;d=t?d:jQuery(d)[0];if("LINK"===d.tagName.toUpperCase()&&e.filter(function(){if(j||this.href!==d.href)return!1;j=!0;jQuery.data(this,a.nss.data)&&jQuery.data(this,a.nss.data,!1);return!0}).length)continue;if("STYLE"===d.tagName.toUpperCase()&&l.filter(function(){if(j||!jQuery.data(this,a.nss.data)||this.innerHTML!==d.innerHTML)return!1;j=!0;jQuery.data(this,a.nss.data,!1);return!0}).length)continue;jQuery.data(jQuery("head").append(d).children(":last-child")[0],
a.nss.data,!1);d=null}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data)}).remove();!1!==k(a.callbacks.update.css.after,b,[c,a.parameter,g,h,f])&&(a.speedcheck&&a.log.speed.name.push("css"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}},a.load.async||0);a.load.script&&setTimeout(function(){D("async")},a.load.async||0);var D=function(d){if(!1!==k(a.callbacks.update.script.before,b,[c,a.parameter,g,h,f])){var s=[];p=p?p:t?q.find("script").add(q.filter("script")):
B(g,"(?:[^'\"]|^s*)(<script[^>]*?>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");w(a.history,n).script=p;for(var j=0,e;e=p[j];j++)if(e=t?e:jQuery(e)[0],"sync"!==d||e.defer)if(!("async"===d&&e.defer)&&(e.childNodes.length||!(e.src in a.log.script)))e.src&&(a.log.script[e.src]=!0),jQuery.when?(e=e.src?jQuery.ajax(jQuery.extend(!0,{},a.ajax,{url:e.src,dataType:"script",async:!1,global:!1})):jQuery.Deferred().resolve(e),s.push(e)):jQuery("head").append(e),e=null;jQuery.when&&s.length&&jQuery.when.apply(null,
s).done(function(){for(var a=0,b;b=arguments[a];a++)0<Number(b.nodeType)&&eval((b.text||b.textContent||b.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,"/*$0*/"))});k(a.callbacks.update.script.after,b,[c,a.parameter,g,h,f])}};a.load.script&&a.load.sync?setTimeout(function(){jQuery(a.area).length===jQuery(a.area).children("."+a.nss.class4html+"-loaded").filter(function(){return this.clientWidth}).length?(jQuery(a.area).children("."+a.nss.class4html+"-loaded").remove(),setTimeout(function(){D("sync")},
0),a.speedcheck&&a.log.speed.name.push("script"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),a.speedcheck&&console.log(a.log.speed.time),a.speedcheck&&console.log(a.log.speed.name)):setTimeout(function(){arguments.callee()},a.interval)},0):a.load.script&&a.load.script&&setTimeout(function(){D("sync")},a.load.async||0);-1<"click,submit".indexOf(c.type.toLowerCase())&&j.scrollTo(x,y);if((a.cache.click||a.cache.submit||a.cache.popstate)&&"POST"!==a.ajax.type&&!1!==k(a.callbacks.update.cache.save.before,
b,[c,a.parameter,s]))w(a.history,n,d,u,g,h,f),k(a.callbacks.update.cache.save.after,b,[c,a.parameter,s]);if(!1===k(a.callbacks.update.success,b,[c,a.parameter,g,h,f]))break a;if(!1===k(a.callbacks.update.complete,b,[c,a.parameter,g,h,f]))break a;if(!1===k(a.callback,b,[c,a.parameter,g,h,f]))break a;l&&l.test("++",1,0,"update: success")}catch(F){s&&w(a.history,n,d,null);if(!1===k(a.callbacks.update.error,b,[c,a.parameter,g,h,f]))break a;if(!1===k(a.callbacks.update.complete,b,[c,a.parameter,g,h,f]))break a;
l&&l.test("++",1,[n,j.location.href],"update: error");if(a.fallback)return"function"===typeof a.fallback?a.fallback(c):E(c)}!1!==k(a.callbacks.update.after,b,[c,a.parameter,g,h,f])&&(a.on(),a.speedcheck&&a.log.speed.name.push("end"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),l&&l.test("++","url === win.location.href",[n,j.location.href],"update: is updated"),l&&l.end())}}var l=q[a.id]&&q[a.id].validate?q[a.id].validate.clone({name:"jquery.pjax.js :drive()"}):l;l&&l.start();
l&&(l.scope=function(a){return eval(a)});l&&l.test(1,1,0,"drive()");a.speedcheck&&(a.log.speed.fire=c.timeStamp);a.speedcheck&&(a.log.speed.time=[]);a.speedcheck&&(a.log.speed.name=[]);a.speedcheck&&a.log.speed.name.push("fire");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);if(!1===k(a.callbacks.before,b,[c,a.parameter]))return b;if(d)jQuery.when?jQuery.when(A(a.wait)).done(function(){r(d)}):r(d);else{var g,h,f,m,p,u,t=[],x={xhr:function(){f=k(a.callbacks.ajax.xhr,b,[c,a.parameter]);
f=f instanceof Object&&f instanceof j.XMLHttpRequest?f:f||jQuery.ajaxSettings.xhr();f instanceof Object&&(f instanceof j.XMLHttpRequest&&"onprogress"in f)&&f.addEventListener("progress",function(a){u=a.loaded},!1);return f},dataFilter:function(f,e){g=f;h=e;return k(a.callbacks.ajax.dataFilter,b,[c,a.parameter,g,h])||g},complete:function(e,n){f=e;m=n;k(a.callbacks.ajax.complete,b,[c,a.parameter,f,m])}},y;for(y in x)y in a.callbacks.ajax||"xhr"===y||delete x[y];if("popstate"===c.type.toLowerCase()){if((t=
n.match(/\?[^\s]*/))&&"?"!==t[0])a.ajax.type="GET";a.ajax.data=null}"submit"===c.type.toLowerCase()&&(n=n.replace(/\?[^\s]*/,""),a.ajax.type=jQuery(c.target).attr("method").toUpperCase(),"GET"===a.ajax.type&&(n+="?"+jQuery(c.target).serialize(),a.ajax.data=null),"POST"===a.ajax.type&&(a.ajax.data=jQuery(c.target).serializeArray()));a.server.query&&(n=n.replace(/(#[^\s]*|)$/,(!n.match(/\?/)?"?":"&")+encodeURIComponent(a.server.query)+"=1$1"));a.speedcheck&&a.log.speed.name.push("ajax_start");a.speedcheck&&
a.log.speed.time.push(a.speed.now()-a.log.speed.fire);jQuery.when?jQuery.when(A(a.wait),jQuery.ajax(jQuery.extend(!0,{},a.ajax,x,{url:n,beforeSend:function(e){f=e;f.setRequestHeader(a.nss.requestHeader,"true");f.setRequestHeader(a.nss.requestHeader+"-Area",a.area);f.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);f.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);k(a.callbacks.ajax.beforeSend,b,[c,a.parameter,f])},success:function(e,n,d){g=e;h=n;f=d;k(a.callbacks.ajax.success,
b,[c,a.parameter,g,h,f])},error:function(e,d,g){f=e;m=d;p=g;k(a.callbacks.ajax.error,b,[c,a.parameter,f,m,p]);l&&l.test("++",1,[n,j.location.href],"ajax error");l&&l.end();if(a.fallback)return"function"===typeof a.fallback?a.fallback(c):E(c)}}))).done(function(){r()}).fail().always():jQuery.ajax(jQuery.extend(!0,{},a.ajax,x,{url:n,beforeSend:function(e){f=e;f.setRequestHeader(a.nss.requestHeader,"true");f.setRequestHeader(a.nss.requestHeader+"-Area",a.area);f.setRequestHeader(a.nss.requestHeader+
"-CSS",a.load.css);f.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);k(a.callbacks.ajax.beforeSend,b,[c,a.parameter,f])},success:function(e,n,d){g=e;h=n;f=d;k(a.callbacks.ajax.success,b,[c,a.parameter,g,h,f]);r()},error:function(e,d,g){f=e;m=d;p=g;k(a.callbacks.ajax.error,b,[c,a.parameter,f,m,p]);l&&l.test("++",1,[n,j.location.href],"ajax error");l&&l.end();if(a.fallback)return"function"===typeof a.fallback?a.fallback(c):E(c)}}));if(!1===k(a.callbacks.after,b,[c,a.parameter]))return b}}
function k(b,c,d){if("function"===typeof b)return b.apply(c,d)}function A(b){var c=jQuery.Deferred();if(!b)return c.resolve();setTimeout(function(){c.resolve()},b);return c.promise()}function E(b){"click"===b.type.toLowerCase()?j.location.href=b.currentTarget.href:"submit"===b.type.toLowerCase()?context.submit():"popstate"===b.type.toLowerCase()&&j.location.reload()}function B(b,c){var d=[];b.replace(RegExp(c,"gim"),function(b,a){d.push(a)});return d}function w(b,c,d,e,a,j,k){var l;switch(!0){case b===
m||c===m:break;case d===m:l=b.data[c];break;case null===e:b.order.unshift(c);for(var g=1,h;h=b.order[g];g++)c===h&&b.order.splice(g,1);for(g=b.order.length-1;h=b.order[g];g--)if(g>=r.cache.length||b.size>r.cache.size||(new Date).getTime()>b.data[h].timestamp+r.cache.expire)b.order.pop(),b.size-=b.data[h].size,b.data[h]=null,delete b.data[h];break;default:b.order.unshift(c);for(g=1;h=b.order[g];g++)c===h&&b.order.splice(g,1);if(b.data[c])break;e=e||2*a.length;b.size+=e;b.data[c]={data:null,dataType:j,
XMLHttpRequest:k,title:d,size:e,timestamp:(new Date).getTime()};for(g=b.order.length-1;h=b.order[g];g--)if(g>=r.cache.length||b.size>r.cache.size||(new Date).getTime()>b.data[h].timestamp+r.cache.expire)b.order.pop(),b.size-=b.data[h].size,b.data[h]=null,delete b.data[h]}return l}function F(b,c,d){var e;switch(!0){case c===m:e=jQuery.falsandtru[b];break;case d===m:e=b in jQuery.falsandtru?jQuery.falsandtru[b][c]:m;break;case d!==m:jQuery.falsandtru[b]instanceof Object||(jQuery.falsandtru[b]={}),jQuery.falsandtru[b][c]instanceof
Object&&d instanceof Object?jQuery.extend(!0,jQuery.falsandtru[b][c],d):jQuery.falsandtru[b][c]=d,e=jQuery.falsandtru[b][c]}return e}if("function"===typeof this)return arguments.callee.apply(jQuery(C),arguments);var p=window.validator instanceof Object?window.validator:!1;(p=p?p.clone({name:"jquery.pjax.js",base:!0,timeout:{limit:t&&t.ajax&&t.ajax.timeout?t.ajax.timeout+p.timeout.limit:p.timeout.limit}}):p)&&p.start();p&&p.test(1,1,0,"plugin load");var r=jQuery.extend(!0,{},{id:0,gns:"pjax",ns:m,
area:m,link:'a:not([target])[href^="/"]',form:m,scrollTop:0,scrollLeft:0,ajax:{},contentType:"text/html",cache:{click:!1,submit:!1,popstate:!1,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},content:{},css:{},script:{},cache:{load:{},save:{}}}},parameter:m,load:{css:!1,script:!1,sync:!0,async:0},interval:300,wait:0,fallback:!0,server:{query:""},speedcheck:!1},t),u=[r.gns].concat(r.ns||[]);jQuery.extend(!0,r,{nss:{pjax:u.join("."),click:["click"].concat(u.join(":")).join("."),
submit:["submit"].concat(u.join(":")).join("."),popstate:["popstate"].concat(u.join(":")).join("."),data:u.join(":"),class4html:u.join("-"),requestHeader:["X",u[0].replace(/^\w/,function(b){return b.toUpperCase()})].join("-"),array:u},server:{query:r.server.query.length?r.server.query:r.gns},log:{script:{},speed:{}},history:{order:[],data:{},size:0},timestamp:(new Date).getTime(),disable:!1,on:function(){for(var b=1,c=q.length;b<c;b++)q[b].disable=!1},off:function(){for(var b=1,c=q.length;b<c;b++)q[b].disable=
!0},landing:j.location.href,validate:p,speed:{now:function(){return(new Date).getTime()}}});jQuery.falsandtru||(jQuery.fn.falsandtru=F,jQuery.falsandtru=F);jQuery.falsandtru("share","history",r.history);r.history=jQuery.falsandtru("share","history");if(!("pushState"in j.history&&null!==j.history.pushState)?0:jQuery(r.area).length){var d=r;d.id=q.length;q.push(d);d.link&&jQuery(this).undelegate(d.link,d.nss.click).delegate(d.link,d.nss.click,d.id,function(b){b.timeStamp=(new Date).getTime();if(1<b.which||
(b.metaKey||b.ctrlKey||b.shiftKey||b.altKey)||(j.location.protocol!==this.protocol||j.location.host!==this.host)||j.location.pathname===this.pathname&&j.location.search===this.search&&j.location.hash!==this.hash)return this;var c,d,e;c=q[b.data];d=this.href;c.cache[b.type.toLowerCase()]&&(e=w(c.history,d));e&&b.timeStamp>e.timestamp+c.cache.expire&&(e=m);c.landing&&(c.landing=!1);if(c.disable)return b.preventDefault(),!1;c.off();v(this,b,d,d!==j.location.href,c,e);b.preventDefault();return!1});d.form&&
jQuery(this).undelegate(d.form,d.nss.submit).delegate(d.form,d.nss.submit,d.id,function(b){b.timeStamp=(new Date).getTime();var c,d,e;c=q[b.data];d=jQuery(b.target).attr("action");c.cache[b.type.toLowerCase()]&&(e=w(c.history,d));e&&b.timeStamp>e.timestamp+c.cache.expire&&(e=m);c.landing&&(c.landing=!1);if(c.disable)return b.preventDefault(),!1;c.off();v(this,b,d,!0,c,e);b.preventDefault();return!1});jQuery(j).unbind(d.nss.popstate).bind(d.nss.popstate,d.id,function(b){b.timeStamp=(new Date).getTime();
var c,d,e;c=q[b.data];d=j.location.href;c.cache[b.type.toLowerCase()]&&(e=w(c.history,d));e&&b.timeStamp>e.timestamp+c.cache.expire&&(e=m);if(c.landing){if(c.landing===j.location.href){c.landing=!1;return}c.landing=!1}if(c.disable)return b.preventDefault(),!1;c.off();v(this,b,d,!1,c,e);b.preventDefault();return!1});jQuery("script[src]").each(function(){this.src in d.log.script||(d.log.script[this.src]=!0)})}p&&p.end();return{on:r.on,off:r.off}}if("undefined"!==typeof window.jQuery){jQuery=window.jQuery;
var m=void 0,j=window,C=document,q=["settings"];jQuery.fn.pjax=v;jQuery.pjax=v;v=null}})();
