/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.5.6
 * @updated 2013/04/02
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor YUI Compressor
 */
(function(b){jQuery.fn.pjax=a;jQuery.pjax=a;function a(d){if(typeof this==="function"){return arguments.callee.apply(jQuery(document),arguments)}if(!c()){return this}var i={gns:"pjax",ns:undefined,area:undefined,link:'a:not([target])[href^="/"]',form:undefined,scrollTop:0,scrollLeft:0,ajax:{},callback:function(){},callbacks:{ajax:{},update:{title:{},content:{},css:{},script:{}}},parameter:undefined,load:{css:false,script:false},wait:0,fallback:true},f=jQuery.extend(true,{},i,d);jQuery.extend(true,f,{nss:{click:["click",f.gns+(f.ns===undefined?"":":"+f.ns)].join("."),submit:["submit",f.gns+(f.ns===undefined?"":":"+f.ns)].join("."),popstate:["popstate",f.gns+(f.ns===undefined?"":":"+f.ns)].join("."),data:f.gns+(f.ns===undefined?"":"."+f.ns),requestHeader:["X",f.gns.replace(/^(\w)/,function(k){return k.toUpperCase()})].join("-")}});if(!jQuery(f.area).length){return this}delegate_click:{if(f.link===undefined){break delegate_click}if(f.form!==undefined){break delegate_click}jQuery(this).undelegate(f.link,f.nss.click).delegate(f.link,f.nss.click,f,function(k){if(k.which>1||k.metaKey||k.ctrlKey||k.shiftKey||k.altKey){return this}if(location.protocol!==this.protocol||location.host!==this.host){return this}if(location.pathname===this.pathname&&location.search===this.search&&location.hash!==this.hash){return this}if(location.pathname+location.search+location.hash===this.pathname+this.search+this.hash){k.preventDefault();return this}g.apply(this,[k,this.href,true,k.data]);k.preventDefault()})}delegate_submit:{if(f.form===undefined){break delegate_submit}jQuery(this).undelegate(f.form,f.nss.submit).delegate(f.form,f.nss.submit,f,function(k){g.apply(this,[k,jQuery(k.target).attr("action"),true,k.data]);k.preventDefault()})}bind_popstate:{setTimeout(function(){jQuery(window).unbind(f.nss.popstate).bind(f.nss.popstate,f,function(k){g.apply(this,[k,location.href,false,k.data])})},100)}function c(){return("pushState" in window.history)&&(window.history.pushState!==null)}function g(k,l,z,o){var r,w,y,n,s,v,m=this,u=[],p=[],t={dataFilter:function(C,B){r=C;w=B;return e(o.callbacks.ajax.dataFilter,m,[k,o.parameter,r,w])},complete:function(C,B){y=C;n=B;e(o.callbacks.ajax.complete,m,[k,o.parameter,y,n])}};for(var q in t){if(q in o.callbacks.ajax){continue}delete t[q]}POPSTATE:{if(k.type.toLowerCase()!=="popstate"){break POPSTATE}GET:{if(u===null||u[0]==="?"){break GET}o.ajax.type="GET"}}SUBMIT:{if(k.type.toLowerCase()!=="submit"){break SUBMIT}l=l.replace(/\?[^\s]*/,"");o.ajax.type=jQuery(k.target).attr("method").toUpperCase();GET:{if(o.ajax.type!=="GET"){break GET}l+="?"+jQuery(k.target).serialize()}POST:{if(o.ajax.type!=="POST"){break POST}o.ajax.data=jQuery(k.target).serializeArray()}}e(o.callbacks.before,m,[k,o.parameter]);switch(jQuery().jquery){case"1.0":case"1.0.4":case"1.1.0":case"1.1.2":case"1.1.3":case"1.1.4":case"1.2":case"1.2.3":case"1.2.6":case"1.3":case"1.4":case"1.4.1":case"1.4.2":case"1.4.3":case"1.4.4":A();break;case"1.5":case"1.5.1":case"1.5.2":case"1.6":case"1.6.1":case"1.6.2":case"1.6.3":case"1.6.4":case"1.7":case"1.7.1":case"1.7.2":case"1.8":case"1.8.1":case"1.8.2":case"1.8.3":case"1.9":case"1.9.1":default:x();break}function x(){jQuery.when(h(o.wait),jQuery.ajax(jQuery.extend(true,{},o.ajax,t,{url:l,beforeSend:function(B){y=B;y.setRequestHeader(o.nss.requestHeader,"true");y.setRequestHeader(o.nss.requestHeader+"-Area",o.area);y.setRequestHeader(o.nss.requestHeader+"-CSS",o.load.css);y.setRequestHeader(o.nss.requestHeader+"-Script",o.load.script);e(o.callbacks.ajax.beforeSend,m,[k,o.parameter,y])},success:function(D,C,B){r=D;w=C;y=B;e(o.callbacks.ajax.success,m,[k,o.parameter,r,w,y])},error:function(D,C,B){y=D;n=C;s=B;e(o.callbacks.ajax.error,m,[k,o.parameter,y,n,s]);o.fallback?j(m,true):null}}))).done(function(){try{if(y.getResponseHeader("Content-Type").indexOf("text/html")===-1){throw null}var I=jQuery(r).filter("title").text(),G=jQuery(r).filter('link[rel="stylesheet"], style'),H=jQuery(r).filter("script"),B=o.area.split(","),K=o.scrollLeft===null?jQuery(window).scrollLeft():parseInt(o.scrollLeft),J=o.scrollTop===null?jQuery(window).scrollTop():parseInt(o.scrollTop),E=jQuery(o.area).length,D=jQuery(o.area,r).add(jQuery(r).filter(o.area)).length;e(o.callbacks.update.before,m,[k,o.parameter,r,w]);if(E&&E===D){z?history.pushState(null,window.opera||("userAgent" in window&&userAgent.indexOf("opera")!==-1)?I:document.title,l):null;e(o.callbacks.update.title.before,m,[k,o.parameter,r,w]);document.title=I;e(o.callbacks.update.title.after,m,[k,o.parameter,r,w]);e(o.callbacks.update.content.before,m,[k,o.parameter,r,w]);for(var F=0;F<B.length;F++){jQuery(B[F]).html(jQuery(B[F],r).add(jQuery(r).filter(B[F])).html())}e(o.callbacks.update.content.after,m,[k,o.parameter,r,w]);G:{if(!o.load.css){break G}e(o.callbacks.update.css.before,m,[k,o.parameter,r,w]);jQuery('link[rel="stylesheet"], style').filter(function(){return !jQuery.data(this,o.nss.data,true)});for(var F=0;F<G.length;F++){if(jQuery('link[rel="stylesheet"]').filter(function(){if(this.href===G[F].href){jQuery.data(this,o.nss.data)?jQuery.data(this,o.nss.data,false):null;return true}return false}).length){continue}if(jQuery("style").filter(function(){if(this.innerHTML.replace(/^\s+|\s+$|\n/gm,"")===G[F].innerHTML.replace(/^\s+|\s+$|\n/gm,"")){jQuery.data(this,o.nss.data)?jQuery.data(this,o.nss.data,false):null;return true}return false}).length){continue}jQuery.data(jQuery("head").append(jQuery(G[F].outerHTML)).children(":last-child").get(0),o.nss.data,false)}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,o.nss.data)}).remove();e(o.callbacks.update.css.after,m,[k,o.parameter,r,w])}H:{if(!o.load.script){break H}e(o.callbacks.update.script.before,m,[k,o.parameter,r,w]);for(var F=0;F<H.length;F++){if(jQuery("script[src]").filter(function(){if(this.src===H[F].src){return true}return false}).length){continue}jQuery.data(jQuery("head").append(jQuery(H[F].outerHTML)).children(":last-child").get(0),o.nss.data,false)}e(o.callbacks.update.script.after,m,[k,o.parameter,r,w])}z&&k.type==="click"?window.scrollTo(K,J):null;e(o.callbacks.update.success,m,[k,o.parameter,r,w,y]);e(o.callback,m,[k,o.parameter,r,w,y])}else{e(o.callbacks.update.error,m,[k,o.parameter,r,w]);o.fallback?j(m,false):null}e(o.callbacks.update.complete,m,[k,o.parameter,r,w]);e(o.callbacks.update.after,m,[k,o.parameter,r,w])}catch(C){e(o.callbacks.update.error,m,[k,o.parameter,r,w]);o.fallback?j(m,false):null}}).fail().always(function(){e(o.callbacks.after,m,[k,o.parameter])})}function A(){jQuery.ajax(jQuery.extend(true,{},o.ajax,t,{url:l,beforeSend:function(B){y=B;y.setRequestHeader(o.nss.requestHeader,"true");y.setRequestHeader(o.nss.requestHeader+"-Area",o.area);y.setRequestHeader(o.nss.requestHeader+"-CSS",o.load.css);y.setRequestHeader(o.nss.requestHeader+"-Script",o.load.script);e(o.callbacks.ajax.beforeSend,m,[k,o.parameter,y])},success:function(J,H,G){r=J;w=H;y=G;e(o.callbacks.ajax.success,m,[k,o.parameter,r,w,y]);if(y.status===200){try{if(y.getResponseHeader("Content-Type").indexOf("text/html")===-1){throw null}var L=jQuery(r).filter("title").text(),I=jQuery(r).filter('link[rel="stylesheet"], style'),K=jQuery(r).filter("script"),B=o.area.split(","),N=o.scrollLeft===null?jQuery(window).scrollLeft():parseInt(o.scrollLeft),M=o.scrollTop===null?jQuery(window).scrollTop():parseInt(o.scrollTop),E=jQuery(o.area).length,D=jQuery(o.area,r).add(jQuery(r).filter(o.area)).length;e(o.callbacks.update.before,m,[k,o.parameter,r,w]);if(E&&E===D){z?history.pushState(null,window.opera||("userAgent" in window&&userAgent.indexOf("opera")!==-1)?L:document.title,l):null;e(o.callbacks.update.title.before,m,[k,o.parameter,r,w]);document.title=L;e(o.callbacks.update.title.after,m,[k,o.parameter,r,w]);e(o.callbacks.update.content.before,m,[k,o.parameter,r,w]);for(var F=0;F<B.length;F++){jQuery(B[F]).html(jQuery(B[F],r).add(jQuery(r).filter(B[F])).html())}e(o.callbacks.update.content.after,m,[k,o.parameter,r,w]);I:{if(!o.load.css){break I}e(o.callbacks.update.css.before,m,[k,o.parameter,r,w]);jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,o.nss.data,true)});for(var F=0;F<I.length;F++){if(jQuery('link[rel="stylesheet"]').filter(function(){if(this.href===I[F].href){jQuery.data(this,o.nss.data)?jQuery.data(this,o.nss.data,false):null;return true}return false}).length){continue}if(jQuery("style").filter(function(){if(this.innerHTML.replace(/^\s+|\s+$|\n/gm,"")===I[F].innerHTML.replace(/^\s+|\s+$|\n/gm,"")){jQuery.data(this,o.nss.data)?jQuery.data(this,o.nss.data,false):null;return true}return false}).length){continue}jQuery.data(jQuery("head").append(jQuery(I[F].outerHTML)).children(":last-child").get(0),o.nss.data,false)}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,o.nss.data)}).remove();e(o.callbacks.update.css.after,m,[k,o.parameter,r,w])}K:{if(!o.load.script){break K}e(o.callbacks.update.script.before,m,[k,o.parameter,r,w]);for(var F=0;F<K.length;F++){if(jQuery("script[src]").filter(function(){if(this.src===K[F].src){return true}return false}).length){continue}jQuery.data(jQuery("head").append(jQuery(K[F].outerHTML)).children(":last-child").get(0),o.nss.data,false)}e(o.callbacks.update.script.after,m,[k,o.parameter,r,w])}z&&k.type==="click"?window.scrollTo(N,M):null;e(o.callbacks.update.success,m,[k,o.parameter,r,w,y]);e(o.callback,m,[k,o.parameter,r,w,y])}else{e(o.callbacks.update.error,m,[k,o.parameter,r,w]);o.fallback?j(m,false):null}e(o.callbacks.update.complete,m,[k,o.parameter,r,w]);e(o.callbacks.update.after,m,[k,o.parameter,r,w])}catch(C){e(o.callbacks.update.error,m,[k,o.parameter,r,w]);o.fallback?j(m,false):null}}},error:function(D,C,B){y=D;n=C;s=B;e(o.callbacks.ajax.error,m,[k,o.parameter,y,n,s]);o.fallback?j(m,true):null}}));e(o.callbacks.after,m,[k,o.parameter])}}function h(l){if(!l){return}var k=jQuery.Deferred();setTimeout(function(){k.resolve()},l);return k.promise()}function e(m,l,k){if(typeof m==="function"){return m.apply(l,k)}}function j(k,l){if(k.href!==undefined){location=k.href}else{if(l){location.reload()}}}return this}})(jQuery);