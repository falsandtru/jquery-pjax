/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.9.5
 * @updated 2013/05/03
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor Closure Compiler
 */
(function(){function v(v){function z(c,b,k,p,a,q){function u(l){a:if(a.speedcheck&&a.log.speed.name.push("update_start"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),!1!==g(a.callbacks.update.before,c,[b,a.parameter,j,m,e])){try{if(!l&&-1===e.getResponseHeader("Content-Type").indexOf("text/html"))throw Error();var w,d,q;l&&!1!==g(a.callbacks.update.cache.load.before,c,[b,a.parameter,l])&&(e=l.XMLHttpRequest,j=e.responseText,m=l.dataType,w=l.title,d=l.css,q=l.script,g(a.callbacks.update.cache.load.after,
c,[b,a.parameter,l]));var n=jQuery(j),t=0<n.filter("title").length;w=w?w:t?n.filter("title").text():C(j,"<title>([^<]*)</title>");var x=a.area.split(","),y=null===a.scrollLeft?jQuery(f).scrollLeft():parseInt(a.scrollLeft),z=null===a.scrollTop?jQuery(f).scrollTop():parseInt(a.scrollTop);if(!jQuery(a.area).length||!n.find(a.area).add(n.filter(a.area)).length)throw Error();if(!1!==g(a.callbacks.update.url.before,c,[b,a.parameter,j,m,e])){k=k.replace(RegExp("[?&]"+a.server.query+"=[^&#]*"),"");p&&f.history.pushState("pjax",
f.opera||"userAgent"in f&&-1!==userAgent.indexOf("opera")?w:D.title,k);switch(!0){case /Mobile(\/\w+)? Safari/i.test(f.navigator.userAgent):a.disable=!0,f.history.back(),f.history.forward(),a.disable=!1}g(a.callbacks.update.url.after,c,[b,a.parameter,j,m,e])}!1!==g(a.callbacks.update.title.before,c,[b,a.parameter,j,m,e])&&(D.title=w,g(a.callbacks.update.title.after,c,[b,a.parameter,j,m,e]));if(!1!==g(a.callbacks.update.content.before,c,[b,a.parameter,j,m,e])){for(var r=0,A;A=x[r];r++)jQuery(A).html(n.find(A).add(n.filter(A)).html()),
a.load.script&&a.load.sync&&jQuery(A).append(jQuery("<div/>",{"class":a.nss.class4html+"-loaded",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax"));g(a.callbacks.update.content.after,c,[b,a.parameter,j,m,e])}a.load.css&&
setTimeout(function(){if(!1!==g(a.callbacks.update.css.before,c,[b,a.parameter,j,m,e])){d=d?d:t?n.find('link[rel="stylesheet"], style').add(n.filter('link[rel="stylesheet"], style')):C(j,'(<link[^>]*?rel="stylesheet"[^>]*?>|<style[^>]*?>(.|[\n\r])*?</style>)');a.history.data[k].css=d;jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data,!0)});for(var h=0,l,f;l=d[h];h++){f=!1;l=t?l:jQuery(l)[0];if("LINK"===l.tagName.toUpperCase()&&jQuery('link[rel="stylesheet"]').filter(function(){if(f||
this.href!==l.href)return!1;f=!0;jQuery.data(this,a.nss.data)&&jQuery.data(this,a.nss.data,!1);return!0}).length)continue;if("STYLE"===l.tagName.toUpperCase()&&jQuery("style").filter(function(){if(f||!jQuery.data(this,a.nss.data)||this.innerHTML!==l.innerHTML)return!1;f=!0;jQuery.data(this,a.nss.data,!1);return!0}).length)continue;jQuery.data(jQuery("head").append(l).children(":last-child")[0],a.nss.data,!1);l=null}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,
a.nss.data)}).remove();!1!==g(a.callbacks.update.css.after,c,[b,a.parameter,j,m,e])&&(a.speedcheck&&a.log.speed.name.push("css"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}},a.load.async||0);a.load.script&&setTimeout(function(){B("async")},a.load.async||0);var B=function(l){if(!1!==g(a.callbacks.update.script.before,c,[b,a.parameter,j,m,e])){var h=[];q=q?q:t?n.find("script").add(n.filter("script")):C(j,"(?:[^'\"]|^s*)(<script[^>]*?>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");
a.history.data[k].script=q;for(var f=0,d;d=q[f];f++)if(d=t?d:jQuery(d)[0],"sync"!==l||d.defer)if(!("async"===l&&d.defer)&&(d.childNodes.length||!(d.src in a.log.script)))d.src&&(a.log.script[d.src]=!0),jQuery.when?(d=d.src?jQuery.ajax(jQuery.extend(!0,{},a.ajax,{url:d.src,dataType:"script",async:!1,global:!1})):jQuery.Deferred().resolve(d),h.push(d)):jQuery("head").append(d),d=null;jQuery.when&&h.length&&jQuery.when.apply(null,h).done(function(){for(var a=0,b;b=arguments[a];a++)0<Number(b.nodeType)&&
eval((b.text||b.textContent||b.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,"/*$0*/"))});g(a.callbacks.update.script.after,c,[b,a.parameter,j,m,e])}};a.load.script&&a.load.sync&&setTimeout(function(){jQuery(a.area).length===jQuery(a.area).children("."+a.nss.class4html+"-loaded").filter(function(){return this.clientWidth}).length?(jQuery(a.area).children("."+a.nss.class4html+"-loaded").remove(),setTimeout(function(){B("sync")},0),a.speedcheck&&a.log.speed.name.push("script"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-
a.log.speed.fire),a.speedcheck&&console.log(a.log.speed.time),a.speedcheck&&console.log(a.log.speed.name)):setTimeout(function(){arguments.callee()},a.interval)},0);-1<"click,submit".indexOf(b.type.toLowerCase())&&f.scrollTo(y,z);if((a.cache.click||a.cache.submit||a.cache.popstate)&&"POST"!==a.ajax.type&&!1!==g(a.callbacks.update.cache.save.before,c,[b,a.parameter,l])){var h=a.history;h.order.unshift(k);for(var r=1,s;s=h.order[r];r++)k===s&&h.order.splice(r,1);if(!l){v=v||2*j.length;h.size+=v;h.data[k]=
{data:null,dataType:m,XMLHttpRequest:e,title:w,size:v,timestamp:(new Date).getTime()};for(r=h.order.length-1;s=h.order[r];r--)if(r>=a.cache.length||h.size>a.cache.size||b.timeStamp>h.data[s].timestamp+a.cache.expire)h.order.pop(),h.size-=h.data[s].size,h.data[s]=null,delete h.data[s];a.history=h;g(a.callbacks.update.cache.save.after,c,[b,a.parameter,l])}}if(!1===g(a.callbacks.update.success,c,[b,a.parameter,j,m,e]))break a;if(!1===g(a.callbacks.update.complete,c,[b,a.parameter,j,m,e]))break a;if(!1===
g(a.callback,c,[b,a.parameter,j,m,e]))break a}catch(F){if(l){h=a.history;h.order.unshift(k);for(r=1;s=h.order[r];r++)k===s&&h.order.splice(r,1);for(r=h.order.length-1;s=h.order[r];r--)if(r>=a.cache.length||h.size>a.cache.size||b.timeStamp>h.data[s].timestamp+a.cache.expire)h.order.pop(),h.size-=h.data[s].size,h.data[s]=null,delete h.data[s];a.history=h}if(!1===g(a.callbacks.update.error,c,[b,a.parameter,j,m,e]))break a;if(!1===g(a.callbacks.update.complete,c,[b,a.parameter,j,m,e]))break a;a.fallback&&
E(b)}!1!==g(a.callbacks.update.after,c,[b,a.parameter,j,m,e])&&(a.speedcheck&&a.log.speed.name.push("end"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}}a.speedcheck&&(a.log.speed.fire=b.timeStamp);a.speedcheck&&(a.log.speed.time=[]);a.speedcheck&&(a.log.speed.name=[]);a.speedcheck&&a.log.speed.name.push("fire");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);if(!1===g(a.callbacks.before,c,[b,a.parameter]))return c;if(q)jQuery.when?jQuery.when(B(a.wait)).done(function(){u(q)}):
u(q);else{var j,m,e,d,n,v,t=[],x={xhr:function(){e=g(a.callbacks.ajax.xhr,c,[b,a.parameter]);e=e instanceof f.XMLHttpRequest?e:jQuery.ajaxSettings.xhr();e instanceof f.XMLHttpRequest&&e.addEventListener("progress",function(a){v=a.loaded},!1);return e},dataFilter:function(e,d){j=e;m=d;return g(a.callbacks.ajax.dataFilter,c,[b,a.parameter,j,m])||j},complete:function(l,k){e=l;d=k;g(a.callbacks.ajax.complete,c,[b,a.parameter,e,d])}},y;for(y in x)y in a.callbacks.ajax||"xhr"===y||delete x[y];if("popstate"===
b.type.toLowerCase()){if((t=k.match(/\?[^\s]*/))&&"?"!==t[0])a.ajax.type="GET";a.ajax.data=null}"submit"===b.type.toLowerCase()&&(k=k.replace(/\?[^\s]*/,""),a.ajax.type=jQuery(b.target).attr("method").toUpperCase(),"GET"===a.ajax.type&&(k+="?"+jQuery(b.target).serialize(),a.ajax.data=null),"POST"===a.ajax.type&&(a.ajax.data=jQuery(b.target).serializeArray()));a.server.query&&(k=k.replace(/(#[^\s]*|)$/,(!k.match(/\?/)?"?":"&")+encodeURIComponent(a.server.query)+"=1$1"));a.speedcheck&&a.log.speed.name.push("ajax_start");
a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);jQuery.when?jQuery.when(B(a.wait),jQuery.ajax(jQuery.extend(!0,{},a.ajax,x,{url:k,beforeSend:function(d){e=d;e.setRequestHeader(a.nss.requestHeader,"true");e.setRequestHeader(a.nss.requestHeader+"-Area",a.area);e.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);e.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);g(a.callbacks.ajax.beforeSend,c,[b,a.parameter,e])},success:function(d,k,f){j=d;m=k;e=f;g(a.callbacks.ajax.success,
c,[b,a.parameter,j,m,e])},error:function(k,f,j){e=k;d=f;n=j;g(a.callbacks.ajax.error,c,[b,a.parameter,e,d,n]);a.fallback&&E(b)}}))).done(function(){u()}).fail().always():jQuery.ajax(jQuery.extend(!0,{},a.ajax,x,{url:k,beforeSend:function(d){e=d;e.setRequestHeader(a.nss.requestHeader,"true");e.setRequestHeader(a.nss.requestHeader+"-Area",a.area);e.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);e.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);g(a.callbacks.ajax.beforeSend,c,
[b,a.parameter,e])},success:function(d,k,f){j=d;m=k;e=f;g(a.callbacks.ajax.success,c,[b,a.parameter,j,m,e]);u()},error:function(k,f,j){e=k;d=f;n=j;g(a.callbacks.ajax.error,c,[b,a.parameter,e,d,n]);a.fallback&&E(b)}}));if(!1===g(a.callbacks.after,c,[b,a.parameter]))return c}}function g(c,b,d){if("function"===typeof c)return c.apply(b,d)}function B(c){var b=jQuery.Deferred();if(!c)return b.resolve();setTimeout(function(){b.resolve()},c);return b.promise()}function E(c){"click"===c.type.toLowerCase()?
f.location.href=c.currentTarget.href:"submit"===c.type.toLowerCase()?context.submit():"popstate"===c.type.toLowerCase()&&f.location.reload()}function C(c,b){var d=[];c.replace(RegExp(b,"gim"),function(b,a){d.push(a)});return d}if("function"===typeof this)return arguments.callee.apply(jQuery(D),arguments);var q="object"===typeof window.validator?window.validator:!1;(q=q?q.clone({name:"jquery.pjax.js",base:!0}):q)&&q.start();q&&q.test(1,1,0,"plugin load");var u=jQuery.extend(!0,{},{id:0,gns:"pjax",
ns:n,area:n,link:'a:not([target])[href^="/"]',form:n,scrollTop:0,scrollLeft:0,ajax:{},cache:{click:!1,submit:!1,popstate:!1,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},content:{},css:{},script:{},cache:{load:{},save:{}}}},parameter:n,load:{css:!1,script:!1,sync:!0,async:0},interval:300,wait:0,fallback:!0,server:{query:""},speedcheck:!1},v),d=[u.gns].concat(u.ns||[]);jQuery.extend(!0,u,{nss:{pjax:d.join("."),click:["click"].concat(d.join(":")).join("."),
submit:["submit"].concat(d.join(":")).join("."),popstate:["popstate"].concat(d.join(":")).join("."),data:d.join(":"),class4html:d.join("-"),requestHeader:["X",d[0].replace(/^\w/,function(c){return c.toUpperCase()})].join("-"),array:d},server:{query:u.server.query.length?u.server.query:u.gns},log:{script:{},speed:{}},history:{order:[],data:{},size:0},timestamp:(new Date).getTime(),disable:!1,landing:location.href,speed:{now:function(){return(new Date).getTime()}}});if(!("pushState"in f.history&&null!==
f.history.pushState)?0:jQuery(u.area).length){var p=u;p.id=t.length;t.push(p);p.link&&(p.form||jQuery(this).undelegate(p.link,p.nss.click).delegate(p.link,p.nss.click,p.id,function(c){c.timeStamp=(new Date).getTime();if(1<c.which||(c.metaKey||c.ctrlKey||c.shiftKey||c.altKey)||(f.location.protocol!==this.protocol||f.location.host!==this.host)||f.location.pathname===this.pathname&&f.location.search===this.search&&f.location.hash!==this.hash)return this;var b,d,g;b=t[c.data];d=this.href;b.disable||(b.cache[c.type.toLowerCase()]&&
(g=b.history.data[d]),g&&c.timeStamp>g.timestamp+b.cache.expire&&(g=n),b.landing&&(b.landing=!1),z(this,c,d,d!==f.location.href,b,g),c.preventDefault())}));p.form&&jQuery(this).undelegate(p.form,p.nss.submit).delegate(p.form,p.nss.submit,p.id,function(c){c.timeStamp=(new Date).getTime();var b,d,f;b=t[c.data];d=jQuery(c.target).attr("action");b.disable||(b.cache[c.type.toLowerCase()]&&(f=b.history.data[d]),f&&c.timeStamp>f.timestamp+b.cache.expire&&(f=n),b.landing&&(b.landing=!1),z(this,c,d,!0,b,f),
c.preventDefault())});jQuery(f).unbind(p.nss.popstate).bind(p.nss.popstate,p.id,function(c){c.timeStamp=(new Date).getTime();var b,d,g;b=t[c.data];d=f.location.href;if(!b.disable){b.cache[c.type.toLowerCase()]&&(g=b.history.data[d]);g&&c.timeStamp>g.timestamp+b.cache.expire&&(g=n);if(b.landing){if(b.landing===location.href){b.landing=!1;return}b.landing=!1}z(this,c,d,!1,b,g)}});jQuery("script[src]").each(function(){this.src in p.log.script||(p.log.script[this.src]=!0)})}q&&q.end();return this}if("undefined"!==
typeof window.jQuery){jQuery=window.jQuery;var n=void 0,f=window,D=document,t=["settings"];jQuery.fn.pjax=v;jQuery.pjax=v;v=null}})();
