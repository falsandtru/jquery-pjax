/*
 * 
 * pjax
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.13.0
 * @updated 2013/06/21
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor Closure Compiler
 */
(function(){function u(z){function E(h,b,m,g,c){function s(d){var e=n[a.id]&&n[a.id].validate?n[a.id].validate.clone({name:"jquery.pjax.js - update()"}):e;e&&e.start();e&&(e.scope=function(a){return eval(a)});e&&e.test("1",1,0,"update()");e&&e.test("++",1,0,"update:start");a:if(a.speedcheck&&a.log.speed.name.push("update_start"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),!1!==k(a.callbacks.update.before,h,[b,a.parameter,l,j,f],a.callbacks.async)){var p=window,A=document,c,
q,r;try{e&&e.test("++",1,0,"update:try");e&&e.test("++",1,!d?[a.contentType,f.getResponseHeader("Content-Type")]:0,"update:content-type");if(!d&&!RegExp(a.contentType.replace(/\s*[,;]\s*(.|$)/g,function(a,h){return h?"|"+h:""}),"i").test(f.getResponseHeader("Content-Type")))throw Error("throw: content-type mismatch");e&&e.test("++",d?"'usable'":"'unusable'",0,"update:cache");d&&!1!==k(a.callbacks.update.cache.load.before,h,[b,a.parameter,d],a.callbacks.async)&&(f=d.XMLHttpRequest,l=f.responseText,
j=d.dataType,c=d.title,q=d.css,r=d.script,k(a.callbacks.update.cache.load.after,h,[b,a.parameter,d],a.callbacks.async));e&&e.test("++",1,0,"update:initialize");var v=jQuery(l),u=0<v.filter("title").length,x=a.area.replace(/(\((.*?(\(.*?\).*?)?)*?\)|\S)(,|$)/g,function(a,h,b,f,e){return h+(e?"|":"")}).split(/\s*\|(?!=)\s*/),y=null===a.scrollLeft?jQuery(p).scrollLeft():parseInt(a.scrollLeft),B=null===a.scrollTop?jQuery(p).scrollTop():parseInt(a.scrollTop);c=c?c:u?v.filter("title").text():jQuery("<span/>").html(G(l,
"<title>([^<]*)</title>").join()).text();if(!jQuery(a.area).length||!v.find(a.area).add(v.filter(a.area)).length)throw Error("throw: area length mismatch");e&&e.test("++",1,m,"update:url");if(!1!==k(a.callbacks.update.url.before,h,[b,a.parameter,l,j,f],a.callbacks.async)){m=m.replace(RegExp("[?&]"+a.server.query+"=[^&#]*"),"");g&&p.history.pushState(a.gns,p.opera||-1!==p.navigator.userAgent.toLowerCase().indexOf("opera")?c:A.title,m);switch(!0){case /Mobile(\/\w+)? Safari/i.test(p.navigator.userAgent):p.history.back(),
p.history.forward()}k(a.callbacks.update.url.after,h,[b,a.parameter,l,j,f],a.callbacks.async)}e&&e.test("++",1,c,"update:title");!1!==k(a.callbacks.update.title.before,h,[b,a.parameter,l,j,f],a.callbacks.async)&&(A.title=c,k(a.callbacks.update.title.after,h,[b,a.parameter,l,j,f],a.callbacks.async));e&&e.test("++",1,x,"update:content");if(!1!==k(a.callbacks.update.content.before,h,[b,a.parameter,l,j,f],a.callbacks.async)){for(var A=0,D;D=x[A];A++)jQuery(D).html(v.find(D).add(v.filter(D)).children()),
a.load.script&&a.load.sync&&jQuery(D).append(jQuery("<div/>",{"class":a.nss.class4html+"-loaded",style:"display: block !important; visibility: hidden !important; width: auto !important; height: 0 !important; margin: 0 !important; padding: 0 !important; border: none !important; position: absolute !important; top: -9999px !important; left: -9999px !important; font-size: 12px !important; text-indent: 0 !important;"}).text("pjax"));k(a.callbacks.update.content.after,h,[b,a.parameter,l,j,f],a.callbacks.async)}e&&
e.test("++",1,0,"update:css");a.load.css&&setTimeout(function(){C()},a.load.async||0);var C=function(){var e=n[a.id]&&n[a.id].validate?n[a.id].validate.clone({name:"jquery.pjax.js - load_css()"}):e;e&&e.start();e&&(e.scope=function(a){return eval(a)});if(!1!==k(a.callbacks.update.css.before,h,[b,a.parameter,l,j,f],a.callbacks.async)){q=q?q:u?v.find('link[rel="stylesheet"], style').add(v.filter('link[rel="stylesheet"], style')):G(l,'(<link[^>]*?rel="stylesheet"[^>]*?>|<style[^>]*?>(.|[\n\r])*?</style>)');
w(a.history,m)&&(w(a.history,m).css=q);jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data,!0)});for(var d=0,c,p=jQuery('link[rel="stylesheet"]'),A=jQuery("style"),g;c=q[d];d++){g=!1;c=u?c:jQuery(c)[0];if("LINK"===c.tagName.toUpperCase()&&p.filter(function(){if(g||this.href!==c.href)return!1;g=!0;jQuery.data(this,a.nss.data)&&jQuery.data(this,a.nss.data,!1);return!0}).length)continue;if("STYLE"===c.tagName.toUpperCase()&&A.filter(function(){if(g||!jQuery.data(this,
a.nss.data)||this.innerHTML!==c.innerHTML)return!1;g=!0;jQuery.data(this,a.nss.data,!1);return!0}).length)continue;jQuery.data(jQuery("head").append(c).children(":last-child")[0],a.nss.data,!1);c=null}jQuery('link[rel="stylesheet"], style').filter(function(){return jQuery.data(this,a.nss.data)}).remove();!1!==k(a.callbacks.update.css.after,h,[b,a.parameter,l,j,f],a.callbacks.async)&&(a.speedcheck&&a.log.speed.name.push("css"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire))}e&&
e.end()};e&&e.test("++",1,0,"update:script");a.load.script&&setTimeout(function(){F("async")},a.load.async||0);var F=function(e){var d=n[a.id]&&n[a.id].validate?n[a.id].validate.clone({name:"jquery.pjax.js - load_script()"}):d;d&&d.start();d&&(d.scope=function(a){return eval(a)});if(!1!==k(a.callbacks.update.script.before,h,[b,a.parameter,l,j,f],a.callbacks.async)){var c=[];r=r?r:u?v.find("script").add(v.filter("script")):G(l,"(?:[^'\"]|^s*)(<script[^>]*?>(.|[\n\r])*?\x3c/script>)(?:[^'\"]|s*$)");
w(a.history,m)&&(w(a.history,m).script=r);for(var p=0,g;g=r[p];p++)if(g=u?g:jQuery(g)[0],"sync"!==e||g.defer)if(!("async"===e&&g.defer)&&(g.childNodes.length||!(g.src in a.log.script)))g.src&&(a.log.script[g.src]=!0),jQuery.when?(g=g.src?jQuery.ajax(jQuery.extend(!0,{},a.ajax,{url:g.src,dataType:"script",async:!1,global:!1})):jQuery.Deferred().resolve(g),c.push(g)):jQuery("head").append(g),g=null;jQuery.when&&c.length&&jQuery.when.apply(null,c).done(function(){for(var a=0,h;h=arguments[a];a++)0<Number(h.nodeType)&&
eval((h.text||h.textContent||h.innerHTML||"").replace(/^\s*<!(?:\[CDATA\[|\-\-)/,"/*$0*/"))});k(a.callbacks.update.script.after,h,[b,a.parameter,l,j,f],a.callbacks.async)}d&&d.end()};a.load.script&&a.load.sync?setTimeout(function(){jQuery(a.area).length===jQuery(a.area).children("."+a.nss.class4html+"-loaded").filter(function(){return this.clientWidth}).length?(jQuery(a.area).children("."+a.nss.class4html+"-loaded").remove(),setTimeout(function(){F("sync")},0),a.speedcheck&&a.log.speed.name.push("script"),
a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),a.speedcheck&&console.log(a.log.speed.time),a.speedcheck&&console.log(a.log.speed.name)):setTimeout(function(){arguments.callee()},a.interval)},0):a.load.script&&setTimeout(function(){F("sync")},a.load.async||0);e&&e.test("++",1,0,"update:scroll");switch(b.type.toLowerCase()){case "click":p.scrollTo(y,B);break;case "submit":p.scrollTo(y,B);break;case "popstate":p.history.state instanceof Object&&isFinite(p.history.state.scrollY)&&
(p.scrollTo(y,p.history.state.scrollY),p.history.state.scrollY=t,p.history.replaceState(p.history.state,c,m))}e&&e.test("++",1,0,"update:cache");if((a.cache.click||a.cache.submit||a.cache.popstate)&&"POST"!==a.ajax.type&&!1!==k(a.callbacks.update.cache.save.before,h,[b,a.parameter,d],a.callbacks.async))w(a.history,m,c,z,l,j,f),k(a.callbacks.update.cache.save.after,h,[b,a.parameter,d],a.callbacks.async);e&&e.test("++",1,0,"update:verify");if(!1!==k(a.callbacks.update.verify.before,h,[b,a.parameter],
a.callbacks.async)){if(m===p.location.href)a.retry=!0;else if(a.retry)a.retry=!1,E(h,b,p.location.href,!1,a.cache[b.type.toLowerCase()]?w(a.history,p.location.href):t);else throw Error("throw: location mismatch");k(a.callbacks.update.verify.after,h,[b,a.parameter],a.callbacks.async)}if(!1===k(a.callbacks.update.success,h,[b,a.parameter,l,j,f],a.callbacks.async))break a;if(!1===k(a.callbacks.update.complete,h,[b,a.parameter,l,j,f],a.callbacks.async))break a;if(!1===k(a.callback,h,[b,a.parameter,l,
j,f],a.callbacks.async))break a;e&&e.test("++",1,0,"update: success")}catch(H){e&&e.test("++",!String(H.message).indexOf("throw:"),H,"update:catch");e&&e.test("++",!("throw: location mismatch"===H.message&&m!==p.location.href),[m,p.location.href],"!( err.message === 'throw: location mismatch' && url !== win.location.href )");d&&w(a.history,m,c,null);if(!1===k(a.callbacks.update.error,h,[b,a.parameter,l,j,f],a.callbacks.async))break a;if(!1===k(a.callbacks.update.complete,h,[b,a.parameter,l,j,f],a.callbacks.async))break a;
e&&e.test("++",1,[m,p.location.href],"update: error");if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):I(b,e)}!1!==k(a.callbacks.update.after,h,[b,a.parameter,l,j,f],a.callbacks.async)&&(a.on(),a.speedcheck&&a.log.speed.name.push("end"),a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire),e&&e.test("++",1,0,"update:end"),e&&e.end())}}var d=n[a.id]&&n[a.id].validate?n[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):d;d&&d.start();d&&(d.scope=function(a){return eval(a)});
d&&d.test(1,1,[m,b.type],"drive()");d&&d.test(2,1,0,"drive:start");a.speedcheck&&(a.log.speed.fire=b.timeStamp);a.speedcheck&&(a.log.speed.time=[]);a.speedcheck&&(a.log.speed.name=[]);a.speedcheck&&a.log.speed.name.push("fire");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);if(!1!==k(a.callbacks.before,h,[b,a.parameter],a.callbacks.async))if(c)d&&d.test(3,1,0,"drive:update"),jQuery.when?jQuery.when(u(a.wait)).done(function(){s(c)}):s(c),d&&d.test(4,1,0,"drive:end"),d&&d.end();
else{d&&d.test(3,1,0,"drive:initialize");var l,j,f,r,x,z,y=[],B={xhr:function(){f=k(a.callbacks.ajax.xhr,h,[b,a.parameter],a.callbacks.async);f=f instanceof Object&&f instanceof q.XMLHttpRequest?f:f||jQuery.ajaxSettings.xhr();f instanceof Object&&(f instanceof q.XMLHttpRequest&&"onprogress"in f)&&f.addEventListener("progress",function(a){z=a.loaded},!1);return f},dataFilter:function(f,e){l=f;j=e;return k(a.callbacks.ajax.dataFilter,h,[b,a.parameter,l,j],a.callbacks.async)||l},complete:function(d,
e){f=d;r=e;k(a.callbacks.ajax.complete,h,[b,a.parameter,f,r],a.callbacks.async)}},C;for(C in B)C in a.callbacks.ajax||"xhr"===C||delete B[C];d&&d.test(4,1,0,"drive:popstate");if("popstate"===b.type.toLowerCase()){if((y=m.match(/\?[^\s]*/))&&"?"!==y[0])a.ajax.type="GET";a.ajax.data=null}d&&d.test(5,1,0,"drive:submit");"submit"===b.type.toLowerCase()&&(m=m.replace(/\?[^\s]*/,""),a.ajax.type=jQuery(b.target).attr("method").toUpperCase(),"GET"===a.ajax.type&&(d&&d.test(5.1,1,jQuery(b.target).serialize(),
"drive:serialize"),m+="?"+jQuery(b.target).serialize(),a.ajax.data=null),"POST"===a.ajax.type&&(d&&d.test(5.1,1,jQuery(b.target).serializeArray(),"drive:serializeArray"),a.ajax.data=jQuery(b.target).serializeArray()));d&&d.test(6,1,0,"drive:url");a.server.query&&(m=m.replace(/(#[^\s]*|)$/,(!m.match(/\?/)?"?":"&")+encodeURIComponent(a.server.query)+"=1$1"));d&&d.test(7,1,0,"drive:ajax");a.speedcheck&&a.log.speed.name.push("ajax_start");a.speedcheck&&a.log.speed.time.push(a.speed.now()-a.log.speed.fire);
jQuery.when?jQuery.when(u(a.wait),jQuery.ajax(jQuery.extend(!0,{},a.ajax,B,{url:m,beforeSend:function(d){f=d;f.setRequestHeader(a.nss.requestHeader,"true");f.setRequestHeader(a.nss.requestHeader+"-Area",a.area);f.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);f.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);k(a.callbacks.ajax.beforeSend,h,[b,a.parameter,f],a.callbacks.async)},success:function(d,e,m){l=d;j=e;f=m;k(a.callbacks.ajax.success,h,[b,a.parameter,l,j,f],a.callbacks.async)},
error:function(d,e,c){f=d;r=e;x=c;var g=n[a.id]&&n[a.id].validate?n[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):g;g&&g.start();g&&g.test("++",1,[m,q.location.href],"ajax_regular()");g&&g.test("++",1,[f,r,x],"ajax error");k(a.callbacks.ajax.error,h,[b,a.parameter,f,r,x],a.callbacks.async);if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):I(b,g);g&&g.end()}}))).done(function(){s()}).fail().always():jQuery.ajax(jQuery.extend(!0,{},a.ajax,B,{url:m,beforeSend:function(d){f=d;
f.setRequestHeader(a.nss.requestHeader,"true");f.setRequestHeader(a.nss.requestHeader+"-Area",a.area);f.setRequestHeader(a.nss.requestHeader+"-CSS",a.load.css);f.setRequestHeader(a.nss.requestHeader+"-Script",a.load.script);k(a.callbacks.ajax.beforeSend,h,[b,a.parameter,f],a.callbacks.async)},success:function(d,e,g){l=d;j=e;f=g;k(a.callbacks.ajax.success,h,[b,a.parameter,l,j,f],a.callbacks.async);s()},error:function(d,e,g){f=d;r=e;x=g;var c=n[a.id]&&n[a.id].validate?n[a.id].validate.clone({name:"jquery.pjax.js - drive()"}):
c;c&&c.start();c&&c.test("++",1,[m,q.location.href],"ajax_legacy()");c&&c.test("++",1,[f,r,x],"ajax error");k(a.callbacks.ajax.error,h,[b,a.parameter,f,r,x],a.callbacks.async);if(a.fallback)return"function"===typeof a.fallback?a.fallback(b):I(b,c);c&&c.end()}}));!1!==k(a.callbacks.after,h,[b,a.parameter],a.callbacks.async)&&(d&&d.test(8,1,0,"drive:end"),d&&d.end())}}function k(a,b,c,g){if("function"===typeof a)return g?setTimeout(function(){a.apply(b,c)},0):a.apply(b,c)}function u(a){var b=jQuery.Deferred();
if(!a)return b.resolve();setTimeout(function(){b.resolve()},a);return b.promise()}function I(a,b){b&&b.test("++",1,0,"fallback()");b&&b.end();"click"===a.type.toLowerCase()?q.location.href=a.currentTarget.href:"submit"===a.type.toLowerCase()?context.submit():"popstate"===a.type.toLowerCase()&&q.location.reload()}function G(a,b){var c=[];a.replace(RegExp(b,"gim"),function(a,h){c.push(h)});return c}function w(a,b,c,g,k,n,d){var l;switch(!0){case a===t||b===t:break;case c===t:a.data[b]&&(new Date).getTime()>
a.data[b].timestamp+a.config.expire&&arguments.callee(a,b,null,null);l=a.data[b];break;case null===g:for(var j=0,f;f=a.order[j];j++)b===f&&(a.order.splice(j,1),a.size-=a.data[f].size,a.data[f]=null,delete a.data[f]);break;default:a.order.unshift(b);for(j=1;f=a.order[j];j++)b===f&&a.order.splice(j,1);if(a.data[b])break;g=g||2*k.length;a.size=a.size||0;a.size+=g;a.data[b]={data:null,dataType:n,XMLHttpRequest:d,title:c,size:g,timestamp:(new Date).getTime()};for(j=a.order.length-1;b=a.order[j];j--)if(j>=
a.config.length||a.size>a.config.size||(new Date).getTime()>a.data[b].timestamp+a.config.expire)a.order.splice(j,1),a.size=a.size||0,a.size-=a.data[b].size,a.data[b]=null,delete a.data[b]}return l}function y(a,b,c){var g;switch(!0){case b===t:g=jQuery.falsandtru[a];break;case c===t:g=a in jQuery.falsandtru?jQuery.falsandtru[a][b]:t;break;case c!==t:jQuery.falsandtru[a]instanceof Object||(jQuery.falsandtru[a]={}),jQuery.falsandtru[a][b]instanceof Object&&c instanceof Object?jQuery.extend(!0,jQuery.falsandtru[a][b],
c):jQuery.falsandtru[a][b]=c,g=jQuery.falsandtru[a][b]}return g}if("function"===typeof this)return arguments.callee.apply(jQuery(J),arguments);var s=window.validator instanceof Object?window.validator:!1;(s=s?s.clone({name:"jquery.pjax.js",base:!0,timeout:{limit:z&&z.ajax&&z.ajax.timeout?z.ajax.timeout+s.timeout.limit:s.timeout.limit}}):s)&&s.start();s&&s.test("++",1,0,"pjax()");var a=jQuery.extend(!0,{},{id:0,gns:"pjax",ns:t,area:t,link:'a:not([target])[href^="/"]',form:t,scrollTop:0,scrollLeft:0,
ajax:{},contentType:"text/html",cache:{click:!1,submit:!1,popstate:!1,length:9,size:1048576,expire:18E5},callback:function(){},callbacks:{ajax:{},update:{url:{},title:{},content:{},css:{},script:{},cache:{load:{},save:{}},verify:{}},async:!1},parameter:t,load:{css:!1,script:!1,sync:!0,async:0},interval:300,wait:0,fallback:!0,server:{query:""},speedcheck:!1},z),r=[a.gns].concat(a.ns||[]);jQuery.extend(!0,a,{nss:{pjax:r.join("."),click:["click"].concat(r.join(":")).join("."),submit:["submit"].concat(r.join(":")).join("."),
popstate:["popstate"].concat(r.join(":")).join("."),data:r.join(":"),class4html:r.join("-"),requestHeader:["X",r[0].replace(/^\w/,function(a){return a.toUpperCase()})].join("-"),array:r},server:{query:a.server.query.length?a.server.query:a.gns},log:{script:{},speed:{}},history:{config:a.cache,order:[],data:{}},timestamp:(new Date).getTime(),disable:!1,on:function(){for(var a=1,b=n.length;a<b;a++)n[a].disable=!1},off:function(){for(var a=1,b=n.length;a<b;a++)n[a].disable=!0},landing:q.location.href,
validate:s,retry:!0,speed:{now:function(){return(new Date).getTime()}}});jQuery.falsandtru||(jQuery.fn.falsandtru=y,jQuery.falsandtru=y);jQuery.falsandtru("share","history",a.history);a.history=jQuery.falsandtru("share","history");if(!("pushState"in q.history&&null!==q.history.pushState)?0:jQuery(a.area).length){var c=a;c.id=n.length;n.push(c);c.link&&jQuery(this).undelegate(c.link,c.nss.click).delegate(c.link,c.nss.click,c.id,function(a){a.timeStamp=(new Date).getTime();if(1<a.which||(a.metaKey||
a.ctrlKey||a.shiftKey||a.altKey)||(q.location.protocol!==this.protocol||q.location.host!==this.host)||q.location.pathname===this.pathname&&q.location.search===this.search&&q.location.hash!==this.hash)return this;var b,c,g;b=n[a.data];c=this.href;b.cache[a.type.toLowerCase()]&&(g=w(b.history,c));b.landing&&(b.landing=!1);if(b.disable)return a.preventDefault(),!1;b.off();E(this,a,c,c!==q.location.href,g);a.preventDefault();return!1});c.form&&jQuery(this).undelegate(c.form,c.nss.submit).delegate(c.form,
c.nss.submit,c.id,function(a){a.timeStamp=(new Date).getTime();var b,c,g;b=n[a.data];c=this.action;b.cache[a.type.toLowerCase()]&&(g=w(b.history,c));b.landing&&(b.landing=!1);if(b.disable)return a.preventDefault(),!1;b.off();E(this,a,c,!0,g);a.preventDefault();return!1});jQuery(q).unbind(c.nss.popstate).bind(c.nss.popstate,c.id,function(a){a.timeStamp=(new Date).getTime();var b,c,g;b=n[a.data];c=q.location.href;b.cache[a.type.toLowerCase()]&&(g=w(b.history,c));if(b.landing){if(b.landing===q.location.href){b.landing=
!1;return}b.landing=!1}if(b.disable)return a.preventDefault(),!1;b.off();E(this,a,c,!1,g);a.preventDefault();return!1});jQuery("script[src]").each(function(){this.src in c.log.script||(c.log.script[this.src]=!0)})}s&&s.end();return{on:a.on,off:a.off}}if("undefined"!==typeof window.jQuery){jQuery=window.jQuery;var t=void 0,q=window,J=document,n=["settings"];jQuery.fn.pjax=u;jQuery.pjax=u;u=null}})();
